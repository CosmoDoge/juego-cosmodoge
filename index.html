<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CosmoDoge Flotante ğŸš€</title>

  <!-- Google Fonts: Orbitron -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

  <!-- LibrerÃ­as on-chain -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.41.0/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.5/lib/index.iife.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: black; font-family: 'Orbitron', Arial, sans-serif; }
    canvas { display: block; margin: auto; max-width: 100vw; max-height: 100vh; }

    /* Pantallas superpuestas */
    #pantallaCarga, #startScreen, #gameOverScreen, #newRecordMessage, #playerNameForm, #reclamoForm {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.85); color: white; z-index: 9999; text-align: center;
    }
    #pantallaCarga .spinner {
      width: 60px; height: 60px; border: 6px solid #ffffff22; border-top: 6px solid #0ff;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    #gameOverScreen, #newRecordMessage, #playerNameForm, #reclamoForm { display: none; }
    #gameOverScreen.show { display: flex; opacity: 1; transition: opacity 1s; }
    #reiniciarBtn { margin-top: 20px; display: none; }

    /* HUD */
    .hud { position: absolute; color: white; text-shadow: 2px 2px 5px #000; z-index: 1000; font: 18px 'Orbitron', sans-serif; }
    #scoreDisplay, #coinDisplay, #highScoreDisplay, #contadorCDOGE, #contadorBCOSMO, #shieldDisplay, #imanContador, #nombreJugador {
      left: 10px; position: absolute;
    }
    #scoreDisplay { top: 10px; }
    #coinDisplay { top: 40px; }
    #highScoreDisplay { top: 70px; }
    #contadorCDOGE { top: 100px; color: #0ff; }
    #contadorBCOSMO { top: 130px; color: #faa200; }
    #shieldDisplay { top: 160px; color: #faa; display: none; }
    #imanContador { top: 190px; right: 20px; background: rgba(0,0,0,0.75); padding: 8px; border-radius: 10px; font-size: 16px; display: none; }
    #nombreJugador { top: 10px; left: 50%; transform: translateX(-50%); color: #0ff; }

    /* Botones */
    .fixed { position: fixed; z-index: 10000; transition: opacity .3s; }
    .hiddenUI { opacity: 0; }
    .btn {
      padding: 1rem 2rem; background: #0ff; border: none; border-radius: 10px;
      color: #000; font-size: 1.2rem; font-weight: bold; cursor: pointer;
      transition: transform .2s, box-shadow .2s;
    }
    .btn:hover { transform: scale(1.05); box-shadow: 0 0 10px #0ff; }
    #conectarWalletBtn {
      top: 20px; right: 20px; background: #0ff; color: #000; border: none;
      border-radius: 12px; padding: 10px 20px; font: 16px 'Orbitron', sans-serif; cursor: pointer;
    }
    #menuPrincipal {
      top: 70px; right: 20px; display: flex; flex-direction: column; gap: 10px;
    }

    /* Paneles flotantes */
    #tiendaCDOGE, #rankingPanel {
      position: fixed; background: rgba(0,0,0,0.85); padding: 15px;
      border-radius: 15px; box-shadow: 0 0 15px #0ff; font: 14px 'Orbitron', sans-serif; color: #fff;
      z-index: 10001; display: none;
    }
    #tiendaCDOGE { bottom: 20px; left: 20px; width: 320px; border: 2px solid #0ff; }
    #rankingPanel { top: 200px; left: 50%; transform: translateX(-50%); }
  </style>
</head>

<body>
<!-- Pantalla de carga -->
<div id="pantallaCarga">
  <div class="spinner"></div>
  <p style="font-size:20px;margin-top:20px;">Cargando CosmoDoge...</p>
</div>

<!-- HUD y botones -->
<button id="conectarWalletBtn" class="fixed">ğŸ”— Conectar Wallet</button>
<div id="scoreDisplay" class="hud">ğŸš€ x 0</div>
<div id="coinDisplay" class="hud">ğŸ’° x 0</div>
<div id="highScoreDisplay" class="hud">ğŸ” MÃ¡x: 0</div>
<div id="contadorCDOGE" class="hud">ğŸ’° CDOGE: 0</div>
<div id="contadorBCOSMO" class="hud">ğŸ• BCOSMO: 0</div>
<div id="shieldDisplay" class="hud"></div>
<div id="imanContador"></div>
<div id="nombreJugador" class="hud"></div>

<div id="menuPrincipal" class="fixed">
  <button id="btnTienda" class="btn">ğŸ›’ Tienda</button>
  <button id="btnRanking" class="btn">ğŸ† Ranking</button>
  <button id="btnReclamar" class="btn">ğŸ Reclamar Tokens</button>
</div>

<!-- Tienda -->
<div id="tiendaCDOGE">
  <h3 style="color:#0ff;">ğŸ›’ Tienda CosmoDoge</h3>
  <div style="margin-bottom:15px;padding:10px;background:#111;border:1px solid #0ff;border-radius:10px;">
    <p style="color:#0ff;">ğŸ§² ImÃ¡n Espacial (CDOGE)</p>
    <p style="color:#bbb;">Atrae monedas 1h</p>
    <button id="comprarImanCDOGE" class="btn">Comprar 1,500 $CDOGE</button>
  </div>
  <div style="margin-bottom:15px;padding:10px;background:#111;border:1px solid #faa200;border-radius:10px;">
    <p style="color:#faa200;">ğŸ§² ImÃ¡n Espacial (BCOSMO)</p>
    <p style="color:#bbb;">Atrae monedas 1h</p>
    <button id="comprarImanBCOSMO" class="btn">Comprar 2,500 $BCOSMO</button>
  </div>
  <div style="padding:10px;background:#111;border:1px solid #faa;border-radius:10px;">
    <p style="color:#faa;">ğŸ›¡ï¸ Escudo Protector</p>
    <p style="color:#bbb;">Inmune a 3 colisiones</p>
    <button id="comprarEscudo" class="btn">Comprar 1,000 ğŸª™</button>
  </div>
</div>

<!-- Ranking -->
<div id="rankingPanel">
  <div id="topRanking"></div>
  <button id="closeRanking" class="btn">Cerrar</button>
</div>

<!-- Canvas de juego -->
<canvas id="gameCanvas"></canvas>
<!-- Pantallas superpuestas adicionales -->
<div id="startScreen" style="display:none;">
  <h1>ğŸš€ CosmoDoge Flotante</h1>
  <button id="startButton" class="btn">Â¡Comenzar!</button>
</div>

<div id="gameOverScreen">
  <h1>ğŸš¨ GAME OVER ğŸš¨</h1>
  <p>Puntaje: <span id="finalScore">0</span></p>
  <button id="reiniciarBtn" class="btn">Reiniciar</button>
</div>

<div id="newRecordMessage" style="display:none;">
  <h1>ğŸŒŸ Â¡Nuevo rÃ©cord galÃ¡ctico!</h1>
  <p>Ingresa tu nombre para guardarlo en el ranking:</p>
</div>

<div id="playerNameForm" style="display:none;">
  <input type="text" id="playerName" placeholder="Tu nombre galÃ¡ctico" style="padding:10px;border:none;border-radius:8px;margin-bottom:10px;" />
  <button id="saveScoreButton" class="btn">Guardar Puntaje</button>
</div>

<!-- Formulario de Reclamo de Tokens -->
<div id="reclamoForm" style="display:none;">
  <h2>ğŸ Reclamar Tokens</h2>
  <p id="reclamoInfo" style="margin-bottom:10px;"></p>
  <select id="tokenSelect" style="padding:8px;margin-bottom:10px;border-radius:8px;">
    <option value="CDOGE">CDOGE</option>
    <option value="BCOSMO">BCOSMO</option>
  </select><br/>
  <button id="confirmarReclamo" class="btn">Confirmar Reclamo</button>
  <button id="cancelarReclamo" class="btn" style="background:#f00;color:#fff;margin-top:10px;">Cancelar</button>
</div>

<!-- Firebase ConfiguraciÃ³n -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getFirestore, collection, query, orderBy, limit, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDaM9HtMtTlJXc-V4HfsZ7bbC__ZPe9zIk",
  authDomain: "cosmodogelive.firebaseapp.com",
  projectId: "cosmodogelive",
  storageBucket: "cosmodogelive.appspot.com",
  messagingSenderId: "648227069914",
  appId: "1:648227069914:web:3ef7ac8da4ab52c30deae3"
};
initializeApp(firebaseConfig);
const db = getFirestore();

window.guardarJugadorAutomatic = async (nombre, puntaje, monedas) => {
  await addDoc(collection(db, "jugadores"), {
    nombre: nombre,
    puntaje: puntaje,
    monedas: monedas,
    fecha: serverTimestamp()
  });
};

window.mostrarTopRanking = async () => {
  const lista = document.getElementById("topRanking");
  const snap = await getDocs(query(collection(db, "jugadores"), orderBy("puntaje", "desc"), limit(5)));
  let html = "<h2>ğŸ† Top 5 CosmoDoge</h2><ul style='list-style:none;padding:0;'>";
  snap.forEach((doc, i) => {
    const d = doc.data();
    html += `<li>#${i + 1} <strong>${d.nombre}</strong> â€“ ${d.puntaje} pts â€“ ${d.monedas} ğŸª™</li>`;
  });
  lista.innerHTML = html + "</ul>";
};
</script>
<script>
  // ğŸ® Canvas & ConfiguraciÃ³n Inicial
  const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
  function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  window.addEventListener('resize', resizeCanvas); resizeCanvas();
  
  // Estado de Juego
  let score = 0, coins = parseInt(localStorage.getItem('cdogeCoins')) || 0;
  let highScore = parseInt(localStorage.getItem('cdogeFloatHighScore')) || 0;
  let totalCDOGE = parseInt(localStorage.getItem('cdogeTotalCoins')) || 0;
  let totalBCOSMO = parseInt(localStorage.getItem('bcosmoTotalCoins')) || 0;
  let gameStarted = false, isGameOver = false;
  let timeElapsed = 0, lastScoreTime = 0, lastFondoChange = 0, lastObs = Date.now();
  let gravity = 0.5, jumpPower = -10;
  const gravityLevels = [0.5, 0.6, 0.8, 1.0];
  let skinAstronautaActivo = false;
  
  // Arrays de objetos
  let coinsArr = [], obsArr = [], cdogeArr = [], bcosmoArr = [], cofreArr = [], agujeroArr = [];
  let turnoCoins = true;
  const valorPorMoneda = 50, valorBCOSMO = 50;
  
  // Fondos
  const fondos = ['fondo-cosmodoge-v2.png', 'fondo-cosmodoge-v3.png', 'fondo-cosmodoge-v4.png'];
  let fi = 0;
  const fondoImg = new Image();
  fondoImg.src = fondos[0];
  
  // Doge
  const doge = { x: 80, y: 200, w: 50, h: 50, v: 0, img: new Image() };
  doge.img.src = 'cosmodoge-cohete-juego.png';
  
  // Skins
  const skinAstronauta = new Image();
  skinAstronauta.src = 'cosmodoge-skin-astronauta.png';
  
  // ImÃ¡genes
  const coinImg = new Image(); coinImg.src = 'coin-cosmodoge.png';
  const cdogeImg = new Image(); cdogeImg.src = 'moneda-cosmodoge.png';
  const bcosmoImg = new Image(); bcosmoImg.src = 'moneda-bcosmo.png';
  const cofreImg = new Image(); cofreImg.src = 'cofre-cosmodoge.png';
  const agujeroImg = new Image(); agujeroImg.src = 'obstaculo-agujero-negro.png';
  
  // Sonidos
  const sndJump = new Audio('jump.mp3');
  const sndCoin = new Audio('coin.mp3');
  const sndBoom = new Audio('boom.mp3');
  const sndRecord = new Audio('record.mp3');
  const sndCdoge = new Audio('sonido-moneda-cdoge.mp3');
  const sndBcosmo = new Audio('sonido-moneda-bcosmo.mp3');
  const music = new Audio('music-cosmodoge-theme.mp3');
  music.loop = true;
  music.volume = 0.3;
  
  // ObstÃ¡culos Normales
  const obsImgs = ['obstaculo-estelar.png', 'obstaculo-explosion.png', 'obstaculo-explosion-aire.png'];
  
  // ğŸ› ï¸ Funciones Utilitarias
  function play(s) { s.currentTime = 0; s.play().catch(() => {}); }
  function showMsg(txt, x, y) {
    const d = document.createElement('div');
    Object.assign(d.style, {position:'absolute',left:`${x}px`,top:`${y}px`,color:'#0ff',font:'18px Orbitron',zIndex:10000,transition:'all 1.5s'});
    d.textContent = txt;
    document.body.appendChild(d);
    setTimeout(() => { d.style.opacity = 0; d.style.transform = 'translateY(-40px)'; }, 100);
    setTimeout(() => d.remove(), 1600);
  }
  function updCDOGE() { document.getElementById('contadorCDOGE').textContent = `ğŸ’° CDOGE: ${totalCDOGE}`; }
  function updBCOSMO() { document.getElementById('contadorBCOSMO').textContent = `ğŸ• BCOSMO: ${totalBCOSMO}`; }
  function updDiff(sec) {
    gravity = sec >= 75 ? gravityLevels[3] :
              sec >= 45 ? gravityLevels[2] :
              sec >= 30 ? gravityLevels[1] : gravityLevels[0];
  }
// ğŸ• Dibujar Doge y Auras
function drawAura(p) {
  const expIman = parseInt(localStorage.getItem('imanExpiracion')) || 0;
  const expShield = parseInt(localStorage.getItem('shieldExpiration')) || 0;
  if (Date.now() < expIman) {
    ctx.beginPath();
    ctx.arc(p.x+p.w/2, p.y+p.h/2, p.w*0.8, 0, Math.PI*2);
    ctx.strokeStyle = '#0ffff088';
    ctx.lineWidth = 4;
    ctx.stroke();
  }
  if (Date.now() < expShield) {
    ctx.beginPath();
    ctx.arc(p.x+p.w/2, p.y+p.h/2, p.w*1.2, 0, Math.PI*2);
    ctx.strokeStyle = '#ff0a';
    ctx.lineWidth = 5;
    ctx.setLineDash([5, 15]);
    ctx.stroke();
    ctx.setLineDash([]);
  }
}
function drawDoge() {
  if (skinAstronautaActivo) {
    ctx.drawImage(skinAstronauta, doge.x, doge.y, doge.w, doge.h);
  } else {
    ctx.drawImage(doge.img, doge.x, doge.y, doge.w, doge.h);
  }
  drawAura(doge);
}

// ğŸª™ Monedas normales
function spawnCoinGroup() {
  const amt = Math.floor(Math.random() * 6) + 5;
  for (let i = 0; i < amt; i++) {
    coinsArr.push({x: canvas.width + i * 40, y: Math.random() * (canvas.height - 100), w: 30, h: 30, s: 2});
  }
}
function drawCoins() {
  for (let i = coinsArr.length - 1; i >= 0; i--) {
    const c = coinsArr[i];
    const exp = parseInt(localStorage.getItem('imanExpiracion')) || 0;
    if (Date.now() < exp) {
      const dx = c.x + 15 - (doge.x + doge.w/2), dy = c.y + 15 - (doge.y + doge.h/2), dist = Math.hypot(dx, dy);
      if (dist < 200) { c.x -= dx * 0.05; c.y -= dy * 0.05; }
    }
    c.x -= c.s;
    ctx.drawImage(coinImg, c.x, c.y, c.w, c.h);
    if (doge.x < c.x+c.w && doge.x+doge.w > c.x && doge.y < c.y+c.h && doge.y+doge.h > c.y) {
      coins++;
      localStorage.setItem('cdogeCoins', coins);
      document.getElementById('coinDisplay').textContent = `ğŸ’° x ${coins}`;
      play(sndCoin);
      coinsArr.splice(i, 1);
    }
  }
}

// ğŸš€ ObstÃ¡culos normales
function spawnObstacle() {
  const img = new Image();
  img.src = obsImgs[Math.floor(Math.random() * obsImgs.length)];
  obsArr.push({x: canvas.width, y: Math.random() * (canvas.height - 50), w: 50, h: 50, sX: 2 + Math.random()*2, sY: 0.5 + Math.random()*1.5, img});
}
function drawObstacles() {
  obsArr.forEach((o, i) => {
    o.x -= o.sX;
    o.y += (o.y < doge.y ? o.sY : -o.sY);
    ctx.drawImage(o.img, o.x, o.y, o.w, o.h);
    if (doge.x < o.x+o.w && doge.x+doge.w > o.x && doge.y < o.y+o.h && doge.y+doge.h > o.y) {
      if (!handleCollision()) gameOver();
    }
  });
  obsArr = obsArr.filter(o => o.x + o.w > 0);
}

// ğŸ Cofres Especiales
function spawnCofre() {
  cofreArr.push({x: canvas.width, y: Math.random()*(canvas.height-80), w: 40, h: 40});
}
function drawCofres() {
  for (let i = cofreArr.length-1; i>=0; i--) {
    const c = cofreArr[i];
    c.x -= 3;
    ctx.drawImage(cofreImg, c.x, c.y, c.w, c.h);
    if (doge.x < c.x+c.w && doge.x+doge.w > c.x && doge.y < c.y+c.h && doge.y+doge.h > c.y) {
      coins += 50;
      localStorage.setItem('cdogeCoins', coins);
      document.getElementById('coinDisplay').textContent = `ğŸ’° x ${coins}`;
      play(sndCoin);
      cofreArr.splice(i,1);
      showMsg('ğŸ +50 ğŸª™', c.x, c.y);
    }
  }
}

// ğŸ•³ï¸ Agujeros Negros (Nuevo ObstÃ¡culo Especial)
function spawnAgujero() {
  agujeroArr.push({x: canvas.width, y: Math.random()*(canvas.height-150), w:80, h:80, fuerza:0.03});
}
function drawAgujeros() {
  for (let i = agujeroArr.length-1; i>=0; i--) {
    const a = agujeroArr[i];
    a.x -= 2;
    ctx.drawImage(agujeroImg, a.x, a.y, a.w, a.h);
    const dx = (a.x+a.w/2) - (doge.x+doge.w/2);
    const dy = (a.y+a.h/2) - (doge.y+doge.h/2);
    const dist = Math.hypot(dx,dy);
    if (dist < 200) {
      doge.x += dx*a.fuerza;
      doge.y += dy*a.fuerza;
    }
    if (doge.x < a.x+a.w && doge.x+doge.w > a.x && doge.y < a.y+a.h && doge.y+doge.h > a.y) {
      if (!handleCollision()) gameOver();
    }
  }
  agujeroArr = agujeroArr.filter(a => a.x+a.w>0);
}
// ğŸŒŒ Fondos
function drawBackground() {
  ctx.drawImage(fondoImg, 0, 0, canvas.width, canvas.height);
}

// ğŸ¯ Main Loop
let lastTs = 0;
function loop(ts) {
  if (!gameStarted || isGameOver) return;
  if (!lastTs) lastTs = ts;
  const dt = ts - lastTs;
  lastTs = ts;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawBackground();

  // FÃ­sica de Doge
  doge.v += gravity * (dt/16);
  doge.y += doge.v * (dt/16);

  if (doge.y + doge.h >= canvas.height || doge.y <= 0) {
    if (!handleCollision()) return gameOver();
    doge.y = canvas.height/2;
  }

  drawDoge();
  drawCoins();
  drawObstacles();
  drawCofres();
  drawAgujeros();
  drawCDOGE();
  drawBCOSMO();

  // CronÃ³metros
  timeElapsed += dt;
  const sec = timeElapsed / 1000;

  // Subir score cada 5 segundos
  if (sec - lastScoreTime >= 5) {
    score++;
    lastScoreTime = sec;
    document.getElementById('scoreDisplay').textContent = `ğŸš€ x ${score}`;
  }

  // Cambio de fondo cada 30 segundos
  if (sec - lastFondoChange >= 30) {
    fi = (fi + 1) % fondos.length;
    fondoImg.src = fondos[fi];
    lastFondoChange = sec;
  }

  // Spawneo
  if (Math.floor(timeElapsed / 16) % 150 === 0) spawnCoinGroup();
  const now = Date.now();
  const interval = sec >= 3600 ? 1000 : sec >= 1800 ? 2000 : 3000;
  if (now - lastObs >= interval) {
    spawnObstacle();
    if (Math.random() < 0.5) spawnCofre();
    if (Math.random() < 0.2) spawnAgujero();
    lastObs = now;
  }

  updDiff(sec);

  // Skin Astronauta si supera 25 de score
  if (!skinAstronautaActivo && score >= 25) {
    skinAstronautaActivo = true;
    showMsg('ğŸ‘¨â€ğŸš€ Skin Astronauta desbloqueado!', canvas.width/2, 60);
  }

  requestAnimationFrame(loop);
}
// ğŸ›‘ Game Over
function gameOver() {
  isGameOver = true;
  music.pause();
  music.currentTime = 0;
  document.getElementById('finalScore').textContent = score;
  const go = document.getElementById('gameOverScreen');
  go.style.display = 'flex';
  setTimeout(() => go.classList.add('show'), 10);
  setTimeout(() => document.getElementById('reiniciarBtn').style.display = 'block', 1500);

  if (score > highScore) {
    localStorage.setItem('cdogeFloatHighScore', score);
    highScore = score;
    document.getElementById('highScoreDisplay').textContent = `ğŸ” MÃ¡x: ${highScore}`;
    document.getElementById('newRecordMessage').style.display = 'flex';
    play(sndRecord);
    const u = localStorage.getItem('cosmodogeliveUserName');
    if (!u) {
      document.getElementById('playerNameForm').style.display = 'flex';
    } else {
      guardarJugadorAutomatic(u, score, coins).then(mostrarTopRanking);
    }
  } else play(sndBoom);

  // ğŸ‘‰ Mostrar formulario de reclamo si cumple requisitos
  setTimeout(verificarReclamo, 2000);
}

// âœ… Verificar Reclamos
function verificarReclamo() {
  const totalCDOGE = parseInt(localStorage.getItem('cdogeTotalCoins')) || 0;
  const totalBCOSMO = parseInt(localStorage.getItem('bcosmoTotalCoins')) || 0;
  const puedeCDOGE = totalCDOGE >= 50000;
  const puedeBCOSMO = totalBCOSMO >= 50000;

  if (!puedeCDOGE && !puedeBCOSMO) return;

  let opciones = '';
  if (puedeCDOGE) opciones += '1 - Reclamar $CDOGE\n';
  if (puedeBCOSMO) opciones += '2 - Reclamar $BCOSMO\n';

  const seleccion = prompt(`Â¡Felicidades!\nPuedes reclamar tus tokens reales.\n\n${opciones}\nEscribe el nÃºmero de la opciÃ³n:`);

  if (seleccion === '1' && puedeCDOGE) {
    enviarReclamo('CDOGE');
  } else if (seleccion === '2' && puedeBCOSMO) {
    enviarReclamo('BCOSMO');
  } else {
    alert('OpciÃ³n invÃ¡lida o no cumples requisitos.');
  }
}

// ğŸ“¤ Enviar Reclamo
async function enviarReclamo(tipo) {
  const nombre = localStorage.getItem('cosmodogeliveUserName') || prompt('Â¿CuÃ¡l es tu nombre de jugador?');
  const wallet = prompt('Ingresa tu direcciÃ³n de wallet donde deseas recibir tus tokens:');

  const payload = {
    jugador: nombre,
    wallet: wallet,
    token: tipo,
    fecha: new Date().toISOString()
  };

  try {
    await fetch('https://script.google.com/macros/s/AKfycbzdsdEv22T0mXg5Sdo-DyEnQ_AJ8UK8yJkN9JorxlhkkaqAA3cwzXwGHgTgp7LJtzs6PQ/exec', {
      method: 'POST',
      body: JSON.stringify(payload),
      headers: { 'Content-Type': 'application/json' }
    });

    alert('âœ… Reclamo enviado exitosamente. SerÃ¡ procesado pronto.');
    
    if (tipo === 'CDOGE') {
      const total = parseInt(localStorage.getItem('cdogeTotalCoins')) || 0;
      localStorage.setItem('cdogeTotalCoins', total - 50000);
    } else {
      const total = parseInt(localStorage.getItem('bcosmoTotalCoins')) || 0;
      localStorage.setItem('bcosmoTotalCoins', total - 50000);
    }
    
    updCDOGE();
    updBCOSMO();
  } catch (error) {
    console.error('Error enviando reclamo:', error);
    alert('âŒ Hubo un problema enviando tu reclamo.');
  }
}
// ğŸ”¥ InicializaciÃ³n general
window.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    document.getElementById('pantallaCarga').style.display = 'none';
    document.getElementById('startScreen').style.display = 'flex';

    if (Date.now() < parseInt(localStorage.getItem('imanExpiracion'))) checkIman();
    if (Date.now() < parseInt(localStorage.getItem('shieldExpiration'))) checkShield();
  }, 3000);

  document.getElementById('coinDisplay').textContent = `ğŸ’° x ${coins}`;
  document.getElementById('highScoreDisplay').textContent = `ğŸ” MÃ¡x: ${highScore}`;
  updCDOGE();
  updBCOSMO();

  document.getElementById('conectarWalletBtn').addEventListener('click', mostrarSelectorWallet);
  document.getElementById('btnTienda').addEventListener('click', toggleTienda);
  document.getElementById('btnRanking').addEventListener('click', toggleRanking);
  document.getElementById('comprarImanCDOGE').addEventListener('click', comprarImanCDOGE);
  document.getElementById('comprarImanBCOSMO').addEventListener('click', comprarImanBCOSMO);
  document.getElementById('comprarEscudo').addEventListener('click', buyShield);
  document.getElementById('closeRanking').addEventListener('click', toggleRanking);

  document.getElementById('startButton').addEventListener('click', () => {
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('conectarWalletBtn').classList.add('hiddenUI');
    document.getElementById('menuPrincipal').classList.add('hiddenUI');
    gameStarted = true;
    music.play();
    requestAnimationFrame(loop);
  });

  document.getElementById('reiniciarBtn').addEventListener('click', () => location.reload());

  document.getElementById('saveScoreButton').addEventListener('click', () => {
    const n = document.getElementById('playerName').value.trim();
    if (!n) return alert('Ingresa tu nombre');
    localStorage.setItem('cosmodogeliveUserName', n);
    document.getElementById('playerNameForm').style.display = 'none';
    guardarJugadorAutomatic(n, score, coins).then(mostrarTopRanking);
  });

  canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    if (!gameStarted) document.getElementById('startButton').click();
    else if (!isGameOver) {
      doge.v = jumpPower;
      play(sndJump);
    }
  });

  document.addEventListener('keydown', e => {
    if (e.code === 'Space' && gameStarted && !isGameOver) {
      doge.v = jumpPower;
      play(sndJump);
    }
  });
});
</script>

</body>
</html>
