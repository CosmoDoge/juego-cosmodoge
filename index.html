<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CosmoDoge Flotante üöÄ</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Librer√≠as necesarias -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.41.0/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.5/lib/index.iife.min.js"></script>

  <style>
    /* Estilos generales */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: black; font-family: 'Orbitron', Arial, sans-serif; }
    canvas { display: block; margin: auto; max-width: 100vw; max-height: 100vh; }
    /* Pantallas superpuestas */
    #pantallaCarga, #startScreen, #gameOverScreen, #newRecordMessage, #playerNameForm, #reclamoForm {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.85); color: white; z-index: 9999; text-align: center;
    }
    #pantallaCarga .spinner {
      width: 60px; height: 60px; border: 6px solid #ffffff22; border-top: 6px solid #0ff;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    #gameOverScreen, #newRecordMessage, #playerNameForm, #reclamoForm { display: none; }

    /* HUD */
    .hud { position: absolute; color: white; text-shadow: 2px 2px 5px #000; z-index: 1000; font: 18px 'Orbitron', sans-serif; }
    #scoreDisplay, #coinDisplay, #highScoreDisplay, #contadorCDOGE, #contadorBCOSMO, #shieldDisplay, #imanContador, #nombreJugador {
      left: 10px; position: absolute;
    }
    #scoreDisplay { top: 10px; }
    #coinDisplay { top: 40px; }
    #highScoreDisplay { top: 70px; }
    #contadorCDOGE { top: 100px; color: #0ff; }
    #contadorBCOSMO { top: 130px; color: #faa200; }
    #shieldDisplay { top: 160px; color: #faa; display: none; }
    #imanContador { top: 190px; right: 20px; background: rgba(0,0,0,0.75); padding: 8px; border-radius: 10px; font-size: 16px; display: none; }
    #nombreJugador { top: 10px; left: 50%; transform: translateX(-50%); color: #0ff; }

    /* Botones */
    .fixed { position: fixed; z-index: 10000; transition: opacity .3s; }
    .btn {
      padding: 1rem 2rem; background: #0ff; border: none; border-radius: 10px;
      color: #000; font-size: 1.2rem; font-weight: bold; cursor: pointer;
      transition: transform .2s, box-shadow .2s;
    }
    .btn:hover { transform: scale(1.05); box-shadow: 0 0 10px #0ff; }
    #conectarWalletBtn {
      top: 20px; right: 20px; background: #0ff; color: #000; border: none;
      border-radius: 12px; padding: 10px 20px; font: 16px 'Orbitron', sans-serif; cursor: pointer;
    }
    #menuPrincipal {
      top: 70px; right: 20px; display: flex; flex-direction: column; gap: 10px;
    }

    /* Paneles flotantes */
    #tiendaCDOGE, #rankingPanel {
      position: fixed; background: rgba(0,0,0,0.85); padding: 15px;
      border-radius: 15px; box-shadow: 0 0 15px #0ff; font: 14px 'Orbitron', sans-serif; color: #fff;
      z-index: 10001; display: none;
    }
    #tiendaCDOGE { bottom: 20px; left: 20px; width: 320px; border: 2px solid #0ff; }
    #rankingPanel { top: 200px; left: 50%; transform: translateX(-50%); }
  </style>
</head>

<body>

<!-- Pantalla de carga -->
<div id="pantallaCarga">
  <div class="spinner"></div>
  <p style="font-size:20px;margin-top:20px;">Cargando CosmoDoge...</p>
</div>

<!-- HUD y botones -->
<button id="conectarWalletBtn" class="fixed">üîó Conectar Wallet</button>
<div id="scoreDisplay" class="hud">üöÄ x 0</div>
<div id="coinDisplay" class="hud">üí∞ x 0</div>
<div id="highScoreDisplay" class="hud">üîù M√°x: 0</div>
<div id="contadorCDOGE" class="hud">üí∞ CDOGE: 0</div>
<div id="contadorBCOSMO" class="hud">üêï BCOSMO: 0</div>
<div id="shieldDisplay" class="hud"></div>
<div id="imanContador"></div>
<div id="nombreJugador" class="hud"></div>

<div id="menuPrincipal" class="fixed">
  <button id="btnTienda" class="btn">üõí Tienda</button>
  <button id="btnRanking" class="btn">üèÜ Ranking</button>
  <button id="btnReclamar" class="btn">üéÅ Reclamar Tokens</button>
</div>

<!-- Canvas de juego -->
<canvas id="gameCanvas"></canvas>

<!-- Pantalla de Inicio -->
<div id="startScreen" style="display:none;">
  <h1>üöÄ CosmoDoge Flotante</h1>
  <button id="startButton" class="btn">¬°Comenzar!</button>
</div>

<!-- Pantalla de Game Over -->
<div id="gameOverScreen">
  <h1>üö® GAME OVER üö®</h1>
  <p>Puntaje: <span id="finalScore">0</span></p>
  <button id="reiniciarBtn" class="btn">Reiniciar</button>
</div>

<!-- Mensaje de Nuevo Record -->
<div id="newRecordMessage" style="display:none;">
  <h1>üåü ¬°Nuevo r√©cord gal√°ctico!</h1>
  <p>Ingresa tu nombre para guardarlo.</p>
</div>

<!-- Formulario Nombre Jugador -->
<div id="playerNameForm" style="display:none;">
  <input type="text" id="playerName" placeholder="Tu nombre gal√°ctico" style="padding:10px;border:none;border-radius:8px;margin-bottom:10px;" />
  <button id="saveScoreButton" class="btn">Guardar Puntaje</button>
</div>

<!-- Formulario Reclamo -->
<div id="reclamoForm" style="display:none;">
  <h2>üéÅ Reclamar Tokens</h2>
  <input type="text" id="nombreReclamo" placeholder="Tu nombre gal√°ctico" style="padding:10px;margin:5px;width:80%;" />
  <input type="text" id="walletReclamo" placeholder="Tu direcci√≥n de wallet" style="padding:10px;margin:5px;width:80%;" />
  <select id="tokenReclamo" style="padding:10px;margin:5px;width:80%;">
    <option value="CDOGE">CDOGE</option>
    <option value="BCOSMO">BCOSMO</option>
  </select>
  <button id="enviarReclamoBtn" class="btn">Enviar Reclamo</button>
  <button id="cancelarReclamoBtn" class="btn" style="background:#f00;margin-top:10px;">Cancelar</button>
</div>
<script>
  // Variables de estado
  const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
  function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  window.addEventListener('resize', resizeCanvas); resizeCanvas();
  
  // Variables principales
  let score = 0, coins = parseInt(localStorage.getItem('cdogeCoins')) || 0;
  let highScore = parseInt(localStorage.getItem('cdogeFloatHighScore')) || 0;
  let totalCDOGE = parseInt(localStorage.getItem('cdogeTotalCoins')) || 0;
  let totalBCOSMO = parseInt(localStorage.getItem('bcosmoTotalCoins')) || 0;
  let gameStarted = false, isGameOver = false;
  let timeElapsed = 0, lastScoreTime = 0, lastFondoChange = 0, lastObs = Date.now();
  const gravityLevels = [0.5, 0.6, 0.8, 1.0];
  let gravity = 0.5, jumpPower = -10;
  let skinAstronautaActivo = false;
  let cofres = [], agujeros = [];
  
  // Arrays de entidades
  let coinsArr = [], obsArr = [], cdogeArr = [], bcosmoArr = [];
  const valorPorMoneda = 50, valorBCOSMO = 50;
  let turnoCoins = true;
  
  // Fondos din√°micos
  const fondos = ['fondo-cosmodoge-v2.png', 'fondo-cosmodoge-v3.png', 'fondo-cosmodoge-v4.png'];
  let fi = 0;
  const fondoImg = new Image();
  fondoImg.src = fondos[0];
  
  // Jugador
  const doge = { x: 80, y: 200, w: 50, h: 50, v: 0, img: new Image() };
  doge.img.src = 'cosmodoge-cohete-juego.png';
  
  // Skins
  const skinAstronauta = new Image();
  skinAstronauta.src = 'cosmodoge-skin-astronauta.png';
  
  // Im√°genes
  const coinImg = new Image(); coinImg.src = 'coin-cosmodoge.png';
  const cdogeImg = new Image(); cdogeImg.src = 'moneda-cosmodoge.png';
  const bcosmoImg = new Image(); bcosmoImg.src = 'moneda-bcosmo.png';
  const obsImgs = ['obstaculo-estelar.png', 'obstaculo-explosion.png', 'obstaculo-explosion-aire.png'];
  const agujeroNegroImg = new Image(); agujeroNegroImg.src = 'obstaculo-agujero-negro.png';
  const cofreImg = new Image(); cofreImg.src = 'cofre-espacial.png';
  
  // Sonidos
  const sndJump = new Audio('jump.mp3');
  const sndCoin = new Audio('coin.mp3');
  const sndBoom = new Audio('boom.mp3');
  const sndRecord = new Audio('record.mp3');
  const sndCdoge = new Audio('sonido-moneda-cdoge.mp3');
  const sndBcosmo = new Audio('sonido-moneda-bcosmo.mp3');
  const music = new Audio('music-cosmodoge-theme.mp3');
  music.loop = true;
  music.volume = 0.3;
  
  // Smart Contracts y configuraci√≥n de tokens
  const CDOGE_CON = '0x5dE25281305992d3552a45A3D8ccA7BdfB4AcD3A'.toLowerCase();
  const ERC20_ABI = ['function balanceOf(address) view returns(uint256)','function decimals() view returns(uint8)','function transfer(address,uint256) returns(bool)'];
  const CDOGE_REC = '0x1980dCdDA07071970dEAa69c975F590976Ee667D'.toLowerCase();
  const MINT = '2etLM91LBaxbQ1y3jnzQw8EXKNHAKcXJsHMJJ69opump';
  const RCV = 'A6dnVgGaS1scC2m6hmPdK15D5gs5vDsHS8PEq3xtJKNx';
  
  // Constantes de conexi√≥n con Google Sheets
  const SHEET_URL = "https://script.google.com/macros/s/AKfycbzdsdEv22T0mXg5Sdo-DyEnQ_AJ8UK8yJkN9JorxlhkkaqAA3cwzXwGHgTgp7LJtzs6PQ/exec";
  
  </script>
  <script>
    // Funciones de utilidades r√°pidas
    function play(s) { s.currentTime = 0; s.play().catch(() => {}); }
    function showMsg(txt, x, y) {
      const d = document.createElement('div');
      Object.assign(d.style, {
        position: 'absolute',
        left: `${x}px`,
        top: `${y}px`,
        color: '#0ff',
        font: '18px Orbitron',
        zIndex: 10000,
        transition: 'all 1.5s'
      });
      d.textContent = txt;
      document.body.appendChild(d);
      setTimeout(() => { d.style.opacity = 0; d.style.transform = 'translateY(-40px)'; }, 100);
      setTimeout(() => d.remove(), 1600);
    }
    
    // Actualizar contadores
    function updCDOGE() { document.getElementById('contadorCDOGE').textContent = `üí∞ CDOGE: ${totalCDOGE}`; }
    function updBCOSMO() { document.getElementById('contadorBCOSMO').textContent = `üêï BCOSMO: ${totalBCOSMO}`; }
    
    // Ajustar gravedad en base al tiempo jugado
    function updDiff(sec) {
      gravity = sec >= 75 ? gravityLevels[3] :
                sec >= 45 ? gravityLevels[2] :
                sec >= 30 ? gravityLevels[1] : gravityLevels[0];
    }
    
    // Dibujar fondos
    function drawBackground() {
      ctx.drawImage(fondoImg, 0, 0, canvas.width, canvas.height);
    }
    
    // Aura de im√°n o escudo
    function drawAura(p) {
      const expIman = parseInt(localStorage.getItem('imanExpiracion')) || 0;
      const expShield = parseInt(localStorage.getItem('shieldExpiration')) || 0;
      
      if (Date.now() < expIman) {
        ctx.beginPath();
        ctx.arc(p.x + p.w/2, p.y + p.h/2, p.w * 0.8, 0, Math.PI * 2);
        ctx.strokeStyle = '#0ffff088';
        ctx.lineWidth = 4;
        ctx.stroke();
      }
      if (Date.now() < expShield) {
        ctx.beginPath();
        ctx.arc(p.x + p.w/2, p.y + p.h/2, p.w * 1.2, 0, Math.PI * 2);
        ctx.strokeStyle = '#ff0a';
        ctx.lineWidth = 5;
        ctx.setLineDash([5, 15]);
        ctx.stroke();
        ctx.setLineDash([]);
      }
    }
    
    // Dibujar CosmoDoge
    function drawDoge() {
      if (skinAstronautaActivo) {
        ctx.drawImage(skinAstronauta, doge.x, doge.y, doge.w, doge.h);
      } else {
        ctx.drawImage(doge.img, doge.x, doge.y, doge.w, doge.h);
      }
      drawAura(doge);
    }
    </script>
<script>
  // Obst√°culos normales
  function spawnObstacle() {
    const img = new Image();
    img.src = obsImgs[Math.floor(Math.random() * obsImgs.length)];
    obsArr.push({x: canvas.width, y: Math.random() * (canvas.height - 50), w: 50, h: 50, sX: 2 + Math.random() * 2, sY: 0.5 + Math.random() * 1.5, img});
  }
  
  function drawObstacles() {
    obsArr.forEach((o, i) => {
      o.x -= o.sX;
      o.y += (o.y < doge.y ? o.sY : -o.sY);
      ctx.drawImage(o.img, o.x, o.y, o.w, o.h);
      if (doge.x < o.x + o.w && doge.x + doge.w > o.x && doge.y < o.y + o.h && doge.y + doge.h > o.y) {
        if (!handleCollision()) gameOver();
      }
    });
    obsArr = obsArr.filter(o => o.x + o.w > 0);
  }
  
  // Cofres espaciales
  function spawnCofre() {
    cofreArr.push({x: canvas.width, y: Math.random() * (canvas.height - 80), w: 40, h: 40});
  }
  function drawCofres() {
    for (let i = cofreArr.length - 1; i >= 0; i--) {
      const c = cofreArr[i];
      c.x -= 2;
      ctx.drawImage(cofreImg, c.x, c.y, c.w, c.h);
      if (doge.x < c.x + c.w && doge.x + doge.w > c.x && doge.y < c.y + c.h && doge.y + doge.h > c.y) {
        coins += 50;
        localStorage.setItem('cdogeCoins', coins);
        document.getElementById('coinDisplay').textContent = `üí∞ x ${coins}`;
        play(sndCoin);
        showMsg('+50 ü™ô', c.x, c.y);
        cofreArr.splice(i, 1);
      }
    }
  }
  
  // Agujeros negros especiales
  function spawnAgujeroNegro() {
    agujeroArr.push({x: canvas.width, y: Math.random() * (canvas.height - 100), w: 60, h: 60, fuerza: 0.8});
  }
  function drawAgujerosNegros() {
    agujeroArr.forEach((a, i) => {
      a.x -= 1.5;
      ctx.drawImage(agujeroImg, a.x, a.y, a.w, a.h);
      
      // Atracci√≥n gravitacional
      const dx = (a.x + a.w/2) - (doge.x + doge.w/2);
      const dy = (a.y + a.h/2) - (doge.y + doge.h/2);
      const dist = Math.hypot(dx, dy);
      if (dist < 200) {
        doge.x += dx * a.fuerza * 0.001;
        doge.y += dy * a.fuerza * 0.001;
      }
      
      // Si colisiona con centro => muerte
      if (dist < a.w/3) {
        if (!handleCollision()) gameOver();
      }
    });
    agujeroArr = agujeroArr.filter(a => a.x + a.w > 0);
  }
  
  // Variables auxiliares para cofres y agujeros
  let cofreArr = [];
  let agujeroArr = [];
  
  // Spawnear especiales
  setInterval(() => spawnCofre(), 15000);
  setInterval(() => spawnAgujeroNegro(), 30000);
  </script>
<script>
  // Dibujar fondo espacial
  function drawBackground() {
    ctx.drawImage(fondoImg, 0, 0, canvas.width, canvas.height);
  }
  
  // Monedas normales
  function spawnCoinGroup() {
    const amt = Math.floor(Math.random() * 5) + 5;
    for (let i = 0; i < amt; i++) {
      coinsArr.push({x: canvas.width + i * 40, y: Math.random() * (canvas.height - 100), w: 30, h: 30, s: 2});
    }
  }
  
  function drawCoins() {
    for (let i = coinsArr.length - 1; i >= 0; i--) {
      const c = coinsArr[i];
      const exp = parseInt(localStorage.getItem('imanExpiracion')) || 0;
      if (Date.now() < exp) {
        const dx = (doge.x + doge.w/2) - (c.x + c.w/2);
        const dy = (doge.y + doge.h/2) - (c.y + c.h/2);
        const dist = Math.hypot(dx, dy);
        if (dist < 200) {
          c.x += dx * 0.04;
          c.y += dy * 0.04;
        }
      }
      c.x -= c.s;
      ctx.drawImage(coinImg, c.x, c.y, c.w, c.h);
      if (doge.x < c.x + c.w && doge.x + doge.w > c.x && doge.y < c.y + c.h && doge.y + doge.h > c.y) {
        coins++;
        localStorage.setItem('cdogeCoins', coins);
        document.getElementById('coinDisplay').textContent = `üí∞ x ${coins}`;
        play(sndCoin);
        coinsArr.splice(i, 1);
      }
    }
  }
  
  // Monedas especiales CDOGE y BCOSMO
  function spawnGroupCDOGE() {
    ubic.forEach(p => cdogeArr.push({x: p.x, y: p.y, w: 32, h: 32, got: false}));
  }
  function spawnGroupBCOSMO() {
    ubic.forEach(p => bcosmoArr.push({x: p.x, y: p.y, w: 32, h: 32, got: false}));
  }
  
  function drawCDOGE() {
    for (let i = cdogeArr.length - 1; i >= 0; i--) {
      const m = cdogeArr[i];
      m.x -= 2;
      if (m.x + m.w < 0) { cdogeArr.splice(i, 1); continue; }
      if (!m.got) ctx.drawImage(cdogeImg, m.x, m.y, m.w, m.h);
    }
    collectCDOGE();
  }
  
  function collectCDOGE() {
    for (const m of cdogeArr) {
      if (!m.got) {
        const dx = m.x + 16 - (doge.x + doge.w/2);
        const dy = m.y + 16 - (doge.y + doge.h/2);
        const dist = Math.hypot(dx, dy);
        const exp = parseInt(localStorage.getItem('imanExpiracion')) || 0;
        if (Date.now() < exp && dist < 200) {
          m.x -= dx * 0.04; m.y -= dy * 0.04;
        }
        if (dist < 20) {
          m.got = true;
          totalCDOGE += valorPorMoneda;
          localStorage.setItem('cdogeTotalCoins', totalCDOGE);
          play(sndCdoge);
          showMsg(`+${valorPorMoneda} CDOGE`, m.x, m.y);
          updCDOGE();
        }
      }
    }
  }
  
  function drawBCOSMO() {
    for (let i = bcosmoArr.length - 1; i >= 0; i--) {
      const m = bcosmoArr[i];
      m.x -= 2;
      if (m.x + m.w < 0) { bcosmoArr.splice(i, 1); continue; }
      if (!m.got) ctx.drawImage(bcosmoImg, m.x, m.y, m.w, m.h);
    }
    collectBCOSMO();
  }
  
  function collectBCOSMO() {
    for (const m of bcosmoArr) {
      if (!m.got) {
        const dx = m.x + 16 - (doge.x + doge.w/2);
        const dy = m.y + 16 - (doge.y + doge.h/2);
        const dist = Math.hypot(dx, dy);
        const exp = parseInt(localStorage.getItem('imanExpiracion')) || 0;
        if (Date.now() < exp && dist < 200) {
          m.x -= dx * 0.04; m.y -= dy * 0.04;
        }
        if (dist < 20) {
          m.got = true;
          totalBCOSMO += valorBCOSMO;
          localStorage.setItem('bcosmoTotalCoins', totalBCOSMO);
          play(sndBcosmo);
          showMsg(`+${valorBCOSMO} BCOSMO`, m.x, m.y);
          updBCOSMO();
        }
      }
    }
  }
  
  // Intercalo spawn de monedas CDOGE y BCOSMO
  setInterval(() => { turnoCoins ? spawnGroupCDOGE() : spawnGroupBCOSMO(); turnoCoins = !turnoCoins; }, 20000);
  </script>
<script>
  // Bucle principal de juego
  let lastTs = 0;
  function loop(ts) {
    if (!gameStarted || isGameOver) return;
    if (!lastTs) lastTs = ts;
    const dt = ts - lastTs;
    lastTs = ts;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  
    drawBackground();
    doge.v += gravity * (dt / 16);
    doge.y += doge.v * (dt / 16);
    
    if (doge.y + doge.h >= canvas.height || doge.y <= 0) {
      if (!handleCollision()) return gameOver();
      doge.y = canvas.height / 2;
    }
    
    drawDoge();
    drawCoins();
    drawObstacles();
    drawCDOGE();
    drawBCOSMO();
    drawBlackHoles();
    drawCofres();
  
    timeElapsed += dt;
    const sec = timeElapsed / 1000;
    
    if (sec - lastScoreTime >= 5) {
      score++;
      lastScoreTime = sec;
      document.getElementById('scoreDisplay').textContent = `üöÄ x ${score}`;
    }
    
    if (sec - lastFondoChange >= 30) {
      fi = (fi + 1) % fondos.length;
      fondoImg.src = fondos[fi];
      lastFondoChange = sec;
    }
    
    if (Math.floor(timeElapsed / 16) % 120 === 0) spawnCoinGroup();
    
    const now = Date.now();
    const interval = sec >= 3600 ? 1000 : sec >= 1800 ? 2000 : 3000;
    if (now - lastObs >= interval) {
      spawnObstacle();
      lastObs = now;
    }
    
    updDiff(sec);
  
    if (!skinAstronautaActivo && score >= 25) {
      skinAstronautaActivo = true;
      showMsg('üë®‚ÄçüöÄ Skin Astronauta desbloqueado!', canvas.width/2, 60);
    }
  
    requestAnimationFrame(loop);
  }
  
  // Funci√≥n de Game Over
  function gameOver() {
    isGameOver = true;
    music.pause();
    music.currentTime = 0;
    document.getElementById('finalScore').textContent = score;
    const go = document.getElementById('gameOverScreen');
    go.style.display = 'flex';
    setTimeout(() => go.classList.add('show'), 10);
    setTimeout(() => document.getElementById('reiniciarBtn').style.display = 'block', 1500);
  
    if (score > highScore) {
      localStorage.setItem('cdogeFloatHighScore', score);
      highScore = score;
      document.getElementById('highScoreDisplay').textContent = `üîù M√°x: ${highScore}`;
      document.getElementById('newRecordMessage').style.display = 'flex';
      play(sndRecord);
      const u = localStorage.getItem('cosmodogeliveUserName');
      if (!u) {
        document.getElementById('playerNameForm').style.display = 'flex';
      } else {
        guardarJugadorAutomatic(u, score, coins).then(mostrarTopRanking);
      }
    } else play(sndBoom);
  }
  </script>
<script>
  // Botones y eventos UI
  
  // Mostrar u ocultar tienda
  function toggleTienda() {
    const t = document.getElementById('tiendaCDOGE');
    t.style.display = t.style.display === 'block' ? 'none' : 'block';
  }
  
  // Mostrar u ocultar ranking
  function toggleRanking() {
    const r = document.getElementById('rankingPanel');
    if (r.style.display === 'block') r.style.display = 'none';
    else { mostrarTopRanking(); r.style.display = 'block'; }
  }
  
  // Men√∫ para seleccionar Wallet
  function mostrarSelectorWallet() {
    const opt = prompt('Selecciona tu wallet:\n1 - MetaMask\n2 - Phantom\n3 - Cerrar Wallet');
    if (opt === '1') conectarMetaMask();
    else if (opt === '2') conectarPhantom();
    else if (opt === '3') cerrarWallet();
    else alert('Opci√≥n inv√°lida');
  }
  
  // Iniciar el juego
  document.getElementById('startButton').addEventListener('click', () => {
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('conectarWalletBtn').classList.add('hiddenUI');
    document.getElementById('menuPrincipal').classList.add('hiddenUI');
    gameStarted = true;
    music.play();
    requestAnimationFrame(loop);
  });
  
  // Saltar con teclado (Espacio)
  document.addEventListener('keydown', e => {
    if (e.code === 'Space' && gameStarted && !isGameOver) {
      doge.v = jumpPower;
      play(sndJump);
    }
  });
  
  // Saltar en m√≥vil (Touch)
  canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    if (!gameStarted) document.getElementById('startButton').click();
    else if (!isGameOver) {
      doge.v = jumpPower;
      play(sndJump);
    }
  });
  
  // Reiniciar partida
  document.getElementById('reiniciarBtn').addEventListener('click', () => location.reload());
  
  // Guardar nombre del jugador
  document.getElementById('saveScoreButton').addEventListener('click', () => {
    const n = document.getElementById('playerName').value.trim();
    if (!n) return alert('Ingresa tu nombre');
    localStorage.setItem('cosmodogeliveUserName', n);
    document.getElementById('playerNameForm').style.display = 'none';
    guardarJugadorAutomatic(n, score, coins).then(mostrarTopRanking);
  });
  
  // Conectar Wallet (desde bot√≥n)
  document.getElementById('conectarWalletBtn').addEventListener('click', mostrarSelectorWallet);
  
  // Abrir tienda
  document.getElementById('btnTienda').addEventListener('click', toggleTienda);
  
  // Abrir ranking
  document.getElementById('btnRanking').addEventListener('click', toggleRanking);
  
  // Comprar √≠tems en tienda
  document.getElementById('comprarImanCDOGE').addEventListener('click', comprarImanCDOGE);
  document.getElementById('comprarImanBCOSMO').addEventListener('click', comprarImanBCOSMO);
  document.getElementById('comprarEscudo').addEventListener('click', buyShield);
  
  // Cerrar ranking
  document.getElementById('closeRanking').addEventListener('click', toggleRanking);
  </script>
</body>
</html>
