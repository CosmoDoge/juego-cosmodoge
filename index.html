<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CosmoDoge Flotante üöÄ</title>

  <!-- Librer√≠as de conexi√≥n on-chain -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.41.0/lib/index.iife.min.js"></script>

  <!-- Estilos del Juego -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%;
      height: 100%;
      background: black;
      overflow: hidden;
      touch-action: none;
      font-family: 'Orbitron', sans-serif;
    }
    #gameCanvas {
      position: absolute;
      width: 100%;
      height: 100%;
      background: black;
      display: block;
    }
    .pantalla {
      position: absolute;
      width: 100%;
      height: 100%;
      background: black;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 10;
    }
    #pantallaCarga, #pantallaInicio, #pantallaGameOver, #pantallaRanking, #pantallaTienda {
      display: none;
      color: white;
      text-align: center;
    }
    .boton {
      padding: 10px 20px;
      margin: 10px;
      border: none;
      border-radius: 12px;
      background: #0ff;
      color: black;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.2rem;
      transition: transform 0.2s;
    }
    .boton:hover {
      transform: scale(1.1);
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 5;
      color: white;
      font-size: 18px;
      display: flex;
      flex-direction: column;
    }
    .boton-flotante {
      position: absolute;
      bottom: 20px;
      right: 20px;
      padding: 12px 18px;
      background: #0ff;
      color: black;
      border-radius: 15px;
      font-weight: bold;
      cursor: pointer;
      z-index: 15;
    }
    .boton-flotante:hover {
      transform: scale(1.05);
    }
    #pantallaTienda {
      background: rgba(0,0,0,0.9);
      padding: 20px;
      border-radius: 20px;
    }
    .item-tienda {
      margin: 10px;
      padding: 10px;
      background: #111;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .item-tienda img {
      width: 80px;
      height: 80px;
      margin-bottom: 10px;
    }
    .item-tienda button {
      margin-top: 10px;
    }
  </style>
</head>

<body>

<!-- Canvas del Juego -->
<canvas id="gameCanvas"></canvas>

<!-- Pantalla de Carga -->
<div id="pantallaCarga" class="pantalla">
  <h1>Cargando universo CosmoDoge...</h1>
</div>

<!-- Pantalla de Inicio -->
<div id="pantallaInicio" class="pantalla">
  <img src="pantalla-inicio-juego.png" alt="Inicio CosmoDoge" style="width: 250px; margin-bottom: 20px;">
  <button class="boton" onclick="iniciarJuego()">Comenzar Viaje üöÄ</button>
</div>

<!-- HUD durante Juego -->
<div id="hud">
  <div id="hudScore">Score: 0</div>
  <div id="hudCoins">Monedas: 0</div>
  <div id="hudCDOGE">CDOGE: 0</div>
  <div id="hudBCOSMO">BCOSMO: 0</div>
  <div id="hudItems"></div>
</div>

<!-- Pantalla Game Over -->
<div id="pantallaGameOver" class="pantalla">
  <h1>¬°Fin de la Misi√≥n! üåå</h1>
  <div id="resultadoFinal"></div>
  <button class="boton" onclick="reiniciarJuego()">Reintentar üöÄ</button>
  <button class="boton" onclick="volverInicio()">Volver al Inicio</button>
</div>

<!-- Pantalla Tienda -->
<div id="pantallaTienda" class="pantalla">
  <h2>Tienda C√≥smica üöÄ</h2>
  <div id="tiendaItems"></div>
  <button class="boton" onclick="cerrarTienda()">Cerrar Tienda</button>
</div>

<!-- Pantalla Ranking -->
<div id="pantallaRanking" class="pantalla">
  <h2>Top Exploradores üåå</h2>
  <div id="listaRanking"></div>
  <button class="boton" onclick="cerrarRanking()">Cerrar Ranking</button>
</div>

<!-- Botones flotantes -->
<button id="botonTienda" class="boton-flotante" onclick="abrirTienda()">üõí</button>
<button id="botonRanking" class="boton-flotante" style="bottom: 80px;" onclick="abrirRanking()">üèÜ</button>
<button id="botonWallet" class="boton-flotante" style="bottom: 140px;" onclick="conectarWallet()">üîó</button>

<!-- Precarga de Im√°genes y Sonidos -->
<script>
const recursosPrecarga = [
  "pantalla-inicio-juego.png",
  "ranking-cosmodoge.png",
  "fondo-cosmodoge-inicio.png",
  "fondo-cosmodoge-v2.png",
  "fondo-cosmodoge-v3.png",
  "fondo-cosmodoge-v4.png",
  "cosmodoge-cohete-juego.png",
  "cosmodoge-skin-astronauta.png",
  "cofre-espacial.png",
  "obstaculo-agujero-negro.png",
  "obstaculo-estelar.png",
  "obstaculo-explosion-aire.png",
  "obstaculo-explosion.png",
  "obstaculos-espaciales.png",
  "moneda-cosmodoge.png",
  "moneda-bcosmo.png",
  "token-cdoge-puntos.png",
  "jump.mp3",
  "boom.mp3",
  "coin.mp3",
  "sonido-moneda-cdoge.mp3",
  "sonido-moneda-bcosmo.mp3",
  "record.mp3",
  "music-cosmodoge-theme.mp3"
];

window.onload = () => {
  let cargados = 0;
  recursosPrecarga.forEach(src => {
    const ext = src.split('.').pop();
    if (ext === "png" || ext === "jpg" || ext === "jpeg" || ext === "gif") {
      const img = new Image();
      img.src = src;
      img.onload = () => { cargados++; if (cargados === recursosPrecarga.length) mostrarPantallaInicio(); };
    } else if (ext === "mp3" || ext === "wav" || ext === "ogg") {
      const audio = new Audio();
      audio.src = src;
      audio.onloadeddata = () => { cargados++; if (cargados === recursosPrecarga.length) mostrarPantallaInicio(); };
    }
  });
};

function mostrarPantallaInicio() {
  document.getElementById('pantallaCarga').style.display = 'none';
  document.getElementById('pantallaInicio').style.display = 'flex';
}

</script>
<script>
  let canvas = document.getElementById('gameCanvas');
  let ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  // Variables principales
  let frames = 0;
  let fondos = [];
  let monedas = [];
  let obstaculos = [];
  let cofres = [];
  let score = 0;
  let coins = 0;
  let highScore = localStorage.getItem('highScore') || 0;
  let gravedad = 0.5;
  let saltar = -10;
  let gameOver = false;
  let monedaActual = "moneda-cosmodoge.png";
  let tiempoUltimoCofre = 0;
  
  // Variables de √≠tems
  let imanActivo = false;
  let tiempoImanRestante = 0;
  let escudoActivo = false;
  let escudoColisionesRestantes = 0;
  let skinAstronautaActivo = false;
  
  // Personaje
  const doge = {
    x: canvas.width / 5,
    y: canvas.height / 2,
    width: 60,
    height: 60,
    vy: 0,
    img: new Image(),
  };
  doge.img.src = "cosmodoge-cohete-juego.png";
  
  // Cargar im√°genes de fondos
  const fondoImagenes = [
    "fondo-cosmodoge-v2.png",
    "fondo-cosmodoge-v3.png",
    "fondo-cosmodoge-v4.png"
  ];
  
  // Cargar fondos iniciales
  for (let i = 0; i < 2; i++) {
    fondos.push({
      x: i * canvas.width,
      y: 0,
      width: canvas.width,
      height: canvas.height,
      img: new Image()
    });
    fondos[i].img.src = fondoImagenes[i % fondoImagenes.length];
  }
  
  // Manejo de saltos
  window.addEventListener('keydown', (e) => {
    if (e.code === 'Space' || e.code === 'ArrowUp') {
      doge.vy = saltar;
      new Audio('jump.mp3').play();
    }
  });
  window.addEventListener('touchstart', () => {
    doge.vy = saltar;
    new Audio('jump.mp3').play();
  });
  
  // L√≥gica principal del juego
  function iniciarJuego() {
    document.getElementById('pantallaInicio').style.display = 'none';
    canvas.style.display = 'block';
    gameOver = false;
    frames = 0;
    monedas = [];
    obstaculos = [];
    cofres = [];
    score = 0;
    cargarDatosLocales();
    loop();
  }
  
  // Loop principal
  function loop() {
    if (gameOver) return;
    frames++;
    actualizar();
    dibujar();
    requestAnimationFrame(loop);
  }
  
  // Actualizar posiciones y l√≥gica
  function actualizar() {
    // Movimiento fondos
    fondos.forEach(fondo => {
      fondo.x -= 2;
      if (fondo.x + fondo.width < 0) {
        fondo.x = canvas.width - 10;
        fondo.img.src = fondoImagenes[Math.floor(Math.random() * fondoImagenes.length)];
      }
    });
  
    // Movimiento personaje
    doge.vy += gravedad;
    doge.y += doge.vy;
  
    // L√≠mites de pantalla
    if (doge.y + doge.height > canvas.height) {
      doge.y = canvas.height - doge.height;
      doge.vy = 0;
    }
    if (doge.y < 0) {
      doge.y = 0;
      doge.vy = 0;
    }
  
    // Spawn de monedas
    if (frames % 90 === 0) {
      monedas.push({
        x: canvas.width,
        y: Math.random() * (canvas.height - 60),
        width: 40,
        height: 40,
        tipo: Math.random() < 0.5 ? "moneda-cosmodoge.png" : "moneda-bcosmo.png"
      });
    }
  
    // Spawn de obst√°culos
    if (frames % 180 === 0) {
      obstaculos.push({
        x: canvas.width,
        y: Math.random() * (canvas.height - 120),
        width: 80,
        height: 80,
        tipo: Math.random() < 0.7 ? "obstaculo-estelar.png" : "obstaculo-explosion.png"
      });
    }
  
    // Spawn de cofres especiales
    if (frames - tiempoUltimoCofre > 600 && Math.random() < 0.02) {
      cofres.push({
        x: canvas.width,
        y: Math.random() * (canvas.height - 100),
        width: 60,
        height: 60
      });
      tiempoUltimoCofre = frames;
    }
  
    // Actualizar monedas
    monedas.forEach((moneda, i) => {
      moneda.x -= 4;
      if (moneda.x + moneda.width < 0) monedas.splice(i, 1);
  
      // Colisi√≥n
      if (colision(doge, moneda)) {
        if (moneda.tipo === "moneda-cosmodoge.png") {
          coins++;
          new Audio('sonido-moneda-cdoge.mp3').play();
        } else {
          coins++;
          new Audio('sonido-moneda-bcosmo.mp3').play();
        }
        monedas.splice(i, 1);
      }
    });
  
    // Actualizar obst√°culos
    obstaculos.forEach((obs, i) => {
      obs.x -= 5;
      if (obs.x + obs.width < 0) obstaculos.splice(i, 1);
  
      if (colision(doge, obs)) {
        if (escudoActivo && escudoColisionesRestantes > 0) {
          escudoColisionesRestantes--;
          obstaculos.splice(i, 1);
        } else {
          terminarJuego();
        }
      }
    });
  
    // Actualizar cofres
    cofres.forEach((cofre, i) => {
      cofre.x -= 3;
      if (cofre.x + cofre.width < 0) cofres.splice(i, 1);
  
      if (colision(doge, cofre)) {
        abrirCofre();
        cofres.splice(i, 1);
      }
    });
  
    // HUD
    actualizarHUD();
  }
  
  // Dibujar elementos
  function dibujar() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    fondos.forEach(fondo => ctx.drawImage(fondo.img, fondo.x, fondo.y, fondo.width, fondo.height));
    ctx.drawImage(doge.img, doge.x, doge.y, doge.width, doge.height);
  
    monedas.forEach(moneda => {
      const img = new Image();
      img.src = moneda.tipo;
      ctx.drawImage(img, moneda.x, moneda.y, moneda.width, moneda.height);
    });
  
    obstaculos.forEach(obs => {
      const img = new Image();
      img.src = obs.tipo;
      ctx.drawImage(img, obs.x, obs.y, obs.width, obs.height);
    });
  
    cofres.forEach(cofre => {
      const img = new Image();
      img.src = "cofre-espacial.png";
      ctx.drawImage(img, cofre.x, cofre.y, cofre.width, cofre.height);
    });
  }
  
  // Detecci√≥n de colisiones
  function colision(a, b) {
    return a.x < b.x + b.width &&
           a.x + a.width > b.x &&
           a.y < b.y + b.height &&
           a.y + a.height > b.y;
  }
  
  // HUD actualizaci√≥n
  function actualizarHUD() {
    document.getElementById('hudScore').innerText = `Score: ${score}`;
    document.getElementById('hudCoins').innerText = `Monedas: ${coins}`;
    document.getElementById('hudCDOGE').innerText = `CDOGE: ${cdogeBalance || 0}`;
    document.getElementById('hudBCOSMO').innerText = `BCOSMO: ${bcosmoBalance || 0}`;
  }
  
  // Terminar juego
  function terminarJuego() {
    gameOver = true;
    canvas.style.display = 'none';
    document.getElementById('pantallaGameOver').style.display = 'flex';
    document.getElementById('resultadoFinal').innerText = `Tu score fue ${score}`;
    if (score > highScore) {
      highScore = score;
      localStorage.setItem('highScore', highScore);
      new Audio('record.mp3').play();
    }
  }
  
  // Reiniciar juego
  function reiniciarJuego() {
    window.location.reload();
  }
  
  // Volver a inicio
  function volverInicio() {
    window.location.reload();
  }
  
  // Abrir tienda
  function abrirTienda() {
    document.getElementById('pantallaTienda').style.display = 'flex';
  }
  
  // Cerrar tienda
  function cerrarTienda() {
    document.getElementById('pantallaTienda').style.display = 'none';
  }
  
  // Abrir ranking
  function abrirRanking() {
    document.getElementById('pantallaRanking').style.display = 'flex';
  }
  
  // Cerrar ranking
  function cerrarRanking() {
    document.getElementById('pantallaRanking').style.display = 'none';
  }
  </script>
<script>
  // Conexi√≥n a MetaMask y Phantom
  let provider;
  let signer;
  let walletAddress = "";
  let cdogeBalance = 0;
  let bcosmoBalance = 0;
  
  // Conexi√≥n a MetaMask
  async function conectarWallet() {
    if (window.ethereum) {
      provider = new ethers.providers.Web3Provider(window.ethereum, "any");
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      walletAddress = await signer.getAddress();
      obtenerBalanceCDOGE();
      alert("‚úÖ Wallet conectada: " + walletAddress);
    } else if (window.solana && window.solana.isPhantom) {
      try {
        const resp = await window.solana.connect();
        walletAddress = resp.publicKey.toString();
        obtenerBalanceBCOSMO();
        alert("‚úÖ Wallet Phantom conectada: " + walletAddress);
      } catch (err) {
        console.error(err);
      }
    } else {
      alert("‚ö†Ô∏è Instala MetaMask o Phantom Wallet para continuar.");
    }
  }
  
  // Obtener Balance de $CDOGE en MetaMask
  async function obtenerBalanceCDOGE() {
    const contratoCDOGE = new ethers.Contract("0x5dE25281305992d3552a45A3D8ccA7BdfB4AcD3A", [
      "function balanceOf(address) view returns (uint256)"
    ], provider);
    let balance = await contratoCDOGE.balanceOf(walletAddress);
    cdogeBalance = Number(ethers.utils.formatUnits(balance, 18)).toFixed(2);
  }
  
  // Obtener Balance de $BCOSMO en Phantom
  async function obtenerBalanceBCOSMO() {
    const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
    let balance = await connection.getBalance(new solanaWeb3.PublicKey(walletAddress));
    bcosmoBalance = (balance / solanaWeb3.LAMPORTS_PER_SOL).toFixed(2);
  }
  
  // Construir Tienda
  window.onloadTienda = () => {
    const tiendaItems = document.getElementById('tiendaItems');
    tiendaItems.innerHTML = `
      <div class="item-tienda">
        <img src="token-cdoge-puntos.png" alt="Escudo">
        <h3>Escudo (3 colisiones)</h3>
        <p>1000 monedas internas</p>
        <button class="boton" onclick="comprarEscudo()">Comprar Escudo</button>
      </div>
      <div class="item-tienda">
        <img src="cofre-espacial.png" alt="Im√°n">
        <h3>Im√°n Espacial (1 hora)</h3>
        <p>1500 $CDOGE o 2500 $BCOSMO</p>
        <button class="boton" onclick="comprarIman()">Comprar Im√°n</button>
      </div>
      <div class="item-tienda">
        <img src="cosmodoge-skin-astronauta.png" alt="Skin Astronauta">
        <h3>Skin Astronauta (x1.2 monedas)</h3>
        <p>3500 $CDOGE o 3500 $BCOSMO</p>
        <button class="boton" onclick="comprarSkin()">Comprar Skin</button>
      </div>
    `;
  }
  
  // Comprar Escudo
  function comprarEscudo() {
    if (coins >= 1000) {
      coins -= 1000;
      escudoActivo = true;
      escudoColisionesRestantes = 3;
      localStorage.setItem('escudoActivo', 'true');
      localStorage.setItem('escudoColisionesRestantes', escudoColisionesRestantes);
      alert("‚úÖ Escudo activado. ¬°Protege 3 colisiones!");
      cerrarTienda();
    } else {
      alert("‚ö†Ô∏è No tienes suficientes monedas internas.");
    }
  }
  
  // Comprar Im√°n
  async function comprarIman() {
    if (!walletAddress) {
      alert("‚ö†Ô∏è Conecta tu wallet primero.");
      return;
    }
    let confirmar = confirm("¬øQuieres comprar el Im√°n Espacial por 1500 $CDOGE o 2500 $BCOSMO?");
    if (!confirmar) return;
    
    // Aqu√≠ agregar√≠as la funci√≥n de transferencia real usando ethers.js o solana-web3.js
    // Simulaci√≥n de compra:
    tiempoImanRestante = 60 * 60; // 1 hora
    imanActivo = true;
    localStorage.setItem('imanActivo', 'true');
    localStorage.setItem('tiempoImanRestante', tiempoImanRestante);
    alert("‚úÖ Im√°n espacial activado por 1 hora.");
    cerrarTienda();
  }
  
  // Comprar Skin Astronauta
  async function comprarSkin() {
    if (!walletAddress) {
      alert("‚ö†Ô∏è Conecta tu wallet primero.");
      return;
    }
    let confirmar = confirm("¬øQuieres comprar la Skin Astronauta por 3500 $CDOGE o 3500 $BCOSMO?");
    if (!confirmar) return;
    
    // Aqu√≠ agregar√≠as la funci√≥n de transferencia real
    // Simulaci√≥n de compra:
    skinAstronautaActivo = true;
    localStorage.setItem('skinAstronautaActivo', 'true');
    doge.img.src = "cosmodoge-skin-astronauta.png";
    alert("‚úÖ Skin Astronauta activada permanentemente.");
    cerrarTienda();
  }
  
  // Abrir Cofre
  function abrirCofre() {
    const premio = Math.random();
    if (premio < 0.5) {
      tiempoImanRestante = 5 * 60;
      imanActivo = true;
      localStorage.setItem('imanActivo', 'true');
      localStorage.setItem('tiempoImanRestante', tiempoImanRestante);
      alert("üéÅ Ganaste un Im√°n de 5 minutos!");
    } else {
      escudoActivo = true;
      escudoColisionesRestantes = 1;
      localStorage.setItem('escudoActivo', 'true');
      localStorage.setItem('escudoColisionesRestantes', escudoColisionesRestantes);
      alert("üéÅ Ganaste un Escudo de 1 colisi√≥n!");
    }
  }
  
  // Guardar datos locales
  function cargarDatosLocales() {
    if (localStorage.getItem('imanActivo') === 'true') {
      imanActivo = true;
      tiempoImanRestante = parseInt(localStorage.getItem('tiempoImanRestante'));
    }
    if (localStorage.getItem('escudoActivo') === 'true') {
      escudoActivo = true;
      escudoColisionesRestantes = parseInt(localStorage.getItem('escudoColisionesRestantes'));
    }
    if (localStorage.getItem('skinAstronautaActivo') === 'true') {
      skinAstronautaActivo = true;
      doge.img.src = "cosmodoge-skin-astronauta.png";
    }
  }
  
  // Integraci√≥n Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDaM9HtMtTlJXc-V4HfsZ7bbC__ZPe9zIk",
    authDomain: "cosmodogelive.firebaseapp.com",
    projectId: "cosmodogelive",
    storageBucket: "cosmodogelive.appspot.com",
    messagingSenderId: "648227069914",
    appId: "1:648227069914:web:3ef7ac8da4ab52c30deae3"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  
  // Mostrar Ranking
  async function cargarRanking() {
    const snapshot = await db.collection("ranking").orderBy("score", "desc").limit(10).get();
    const lista = document.getElementById("listaRanking");
    lista.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      lista.innerHTML += `<div>${data.nombre} üöÄ ${data.score} puntos</div>`;
    });
  }
  
  // Guardar Score
  async function guardarPuntaje(nombreJugador) {
    await db.collection("ranking").add({
      nombre: nombreJugador,
      score: score,
      coins: coins
    });
  }
  
  // Reclamar recompensa (ejemplo)
  async function reclamarTokens() {
    if (!walletAddress) {
      alert("‚ö†Ô∏è Conecta tu wallet para reclamar.");
      return;
    }
    alert("üéÅ Recompensa reclamada, ser√° procesada pronto. üöÄ");
    // Aqu√≠ ir√≠a tu funci√≥n de transferencia o notificaci√≥n real
  }
  </script>
<script>
  // Actualizar HUD con mejoras
  function actualizarHUD() {
    document.getElementById('hudScore').innerText = `Score: ${score}`;
    document.getElementById('hudCoins').innerText = `Monedas: ${coins}`;
    document.getElementById('hudCDOGE').innerText = `CDOGE: ${cdogeBalance || 0}`;
    document.getElementById('hudBCOSMO').innerText = `BCOSMO: ${bcosmoBalance || 0}`;
    
    // Mostrar √≠tems activos
    let estado = "";
    if (imanActivo) estado += `üß≤ Im√°n: ${Math.ceil(tiempoImanRestante/60)}min\n`;
    if (escudoActivo && escudoColisionesRestantes > 0) estado += `üõ°Ô∏è Escudo: ${escudoColisionesRestantes} golpes\n`;
    if (skinAstronautaActivo) estado += `üë©‚ÄçüöÄ Skin x1.2 activo\n`;
    document.getElementById('hudItems').innerText = estado;
  }
  
  // Aplicar mejoras en recolecci√≥n
  function recolectarMoneda(tipoMoneda) {
    let cantidad = 1;
    if (skinAstronautaActivo) cantidad = cantidad * 1.2;
    coins += cantidad;
    if (tipoMoneda === "moneda-cosmodoge.png") {
      new Audio('sonido-moneda-cdoge.mp3').play();
    } else {
      new Audio('sonido-moneda-bcosmo.mp3').play();
    }
  }
  
  // Ajustar la detecci√≥n de colisi√≥n de monedas
  function actualizar() {
    fondos.forEach(fondo => {
      fondo.x -= 2;
      if (fondo.x + fondo.width < 0) {
        fondo.x = canvas.width - 10;
        fondo.img.src = fondoImagenes[Math.floor(Math.random() * fondoImagenes.length)];
      }
    });
  
    doge.vy += gravedad;
    doge.y += doge.vy;
  
    if (doge.y + doge.height > canvas.height) {
      doge.y = canvas.height - doge.height;
      doge.vy = 0;
    }
    if (doge.y < 0) {
      doge.y = 0;
      doge.vy = 0;
    }
  
    if (frames % 90 === 0) {
      monedas.push({
        x: canvas.width,
        y: Math.random() * (canvas.height - 60),
        width: 40,
        height: 40,
        tipo: Math.random() < 0.5 ? "moneda-cosmodoge.png" : "moneda-bcosmo.png"
      });
    }
  
    if (frames % 180 === 0) {
      obstaculos.push({
        x: canvas.width,
        y: Math.random() * (canvas.height - 120),
        width: 80,
        height: 80,
        tipo: Math.random() < 0.7 ? "obstaculo-estelar.png" : "obstaculo-explosion.png"
      });
    }
  
    if (frames - tiempoUltimoCofre > 600 && Math.random() < 0.02) {
      cofres.push({
        x: canvas.width,
        y: Math.random() * (canvas.height - 100),
        width: 60,
        height: 60
      });
      tiempoUltimoCofre = frames;
    }
  
    monedas.forEach((moneda, i) => {
      moneda.x -= 4;
      if (moneda.x + moneda.width < 0) monedas.splice(i, 1);
      if (colision(doge, moneda)) {
        recolectarMoneda(moneda.tipo);
        monedas.splice(i, 1);
      }
    });
  
    obstaculos.forEach((obs, i) => {
      obs.x -= 5;
      if (obs.x + obs.width < 0) obstaculos.splice(i, 1);
      if (colision(doge, obs)) {
        if (escudoActivo && escudoColisionesRestantes > 0) {
          escudoColisionesRestantes--;
          obstaculos.splice(i, 1);
        } else {
          terminarJuego();
        }
      }
    });
  
    cofres.forEach((cofre, i) => {
      cofre.x -= 3;
      if (cofre.x + cofre.width < 0) cofres.splice(i, 1);
      if (colision(doge, cofre)) {
        abrirCofre();
        cofres.splice(i, 1);
      }
    });
  
    // Manejar tiempo del im√°n
    if (imanActivo) {
      tiempoImanRestante--;
      if (tiempoImanRestante <= 0) {
        imanActivo = false;
        localStorage.removeItem('imanActivo');
        localStorage.removeItem('tiempoImanRestante');
      } else {
        localStorage.setItem('tiempoImanRestante', tiempoImanRestante);
      }
    }
  
    actualizarHUD();
  }
  
  // Game Over Mejorado
  function terminarJuego() {
    gameOver = true;
    canvas.style.display = 'none';
    document.getElementById('pantallaGameOver').style.display = 'flex';
    let resultado = `Tu score fue ${score}`;
    if (score > highScore) {
      resultado += " üéØ ¬°Nuevo R√©cord!";
      highScore = score;
      localStorage.setItem('highScore', highScore);
      new Audio('record.mp3').play();
    }
    document.getElementById('resultadoFinal').innerText = resultado;
  }
  
  // Animaci√≥n de CosmoDoge flotando
  setInterval(() => {
    if (!gameOver) {
      doge.y += Math.sin(frames / 20) * 0.5;
    }
  }, 100);
  </script>
<script>
  // Variables extra
  let skinTemporalActivo = false;
  let fechaSkinTemporal = null;
  let monedasCDOGEAcumuladas = 0;
  let monedasBCOSMOAcumuladas = 0;
  
  // Funci√≥n para actualizar la HUD incluyendo skin temporal
  function actualizarHUD() {
    document.getElementById('hudScore').innerText = `Score: ${score}`;
    document.getElementById('hudCoins').innerText = `Monedas: ${coins}`;
    document.getElementById('hudCDOGE').innerText = `CDOGE: ${cdogeBalance || 0}`;
    document.getElementById('hudBCOSMO').innerText = `BCOSMO: ${bcosmoBalance || 0}`;
  
    let estado = "";
    if (imanActivo) estado += `üß≤ Im√°n: ${Math.ceil(tiempoImanRestante/60)} min\n`;
    if (escudoActivo && escudoColisionesRestantes > 0) estado += `üõ°Ô∏è Escudo: ${escudoColisionesRestantes} golpes\n`;
    if (skinAstronautaActivo) estado += `üë©‚ÄçüöÄ Skin x1.2 activo\n`;
    if (skinTemporalActivo) estado += tiempoRestanteSkin();
    document.getElementById('hudItems').innerText = estado;
  }
  
  // Detectar desbloqueo autom√°tico de Skin por Score
  function verificarDesbloqueoSkin() {
    if (score >= 25 && !skinTemporalActivo && !skinAstronautaActivo) {
      activarSkinTemporal();
    }
  }
  
  // Activar Skin Astronauta Temporal
  function activarSkinTemporal() {
    skinTemporalActivo = true;
    fechaSkinTemporal = new Date().toISOString();
    localStorage.setItem('skinTemporalActivo', 'true');
    localStorage.setItem('fechaSkinTemporal', fechaSkinTemporal);
    doge.img.src = "cosmodoge-skin-astronauta.png";
    alert("üéâ Has desbloqueado el Skin Astronauta por 3 d√≠as!");
  }
  
  // Verificar expiraci√≥n de Skin temporal
  function verificarExpiracionSkin() {
    if (localStorage.getItem('skinTemporalActivo') === 'true') {
      fechaSkinTemporal = localStorage.getItem('fechaSkinTemporal');
      const fechaDesbloqueo = new Date(fechaSkinTemporal);
      const ahora = new Date();
      const diferencia = (ahora - fechaDesbloqueo) / (1000 * 60 * 60 * 24);
      if (diferencia >= 3) {
        skinTemporalActivo = false;
        localStorage.removeItem('skinTemporalActivo');
        localStorage.removeItem('fechaSkinTemporal');
        doge.img.src = "cosmodoge-cohete-juego.png";
        alert("‚è≥ El Skin Astronauta temporal ha expirado.");
      } else {
        skinTemporalActivo = true;
        doge.img.src = "cosmodoge-skin-astronauta.png";
      }
    }
  }
  
  // Mostrar tiempo restante de Skin
  function tiempoRestanteSkin() {
    if (!fechaSkinTemporal) return "";
    const fechaDesbloqueo = new Date(fechaSkinTemporal);
    const ahora = new Date();
    const msRestante = (fechaDesbloqueo.getTime() + (3 * 24 * 60 * 60 * 1000)) - ahora.getTime();
    const dias = Math.floor(msRestante / (1000 * 60 * 60 * 24));
    const horas = Math.floor((msRestante % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    return `üë©‚ÄçüöÄ Skin: ${dias}d ${horas}h restantes\n`;
  }
  
  // L√≥gica de Recolecci√≥n de monedas reales
  function recolectarMoneda(tipoMoneda) {
    let cantidad = 1;
    if (skinAstronautaActivo || skinTemporalActivo) cantidad = cantidad * 1.2;
    coins += cantidad;
  
    if (tipoMoneda === "moneda-cosmodoge.png") {
      monedasCDOGEAcumuladas += cantidad;
      new Audio('sonido-moneda-cdoge.mp3').play();
    } else {
      monedasBCOSMOAcumuladas += cantidad;
      new Audio('sonido-moneda-bcosmo.mp3').play();
    }
  }
  
  // Mostrar bot√≥n Reclamar Tokens
  function actualizarBotonReclamar() {
    let botonExistente = document.getElementById('botonReclamarTokens');
    if (!botonExistente && (monedasCDOGEAcumuladas >= 50000 || monedasBCOSMOAcumuladas >= 50000)) {
      const boton = document.createElement('button');
      boton.id = 'botonReclamarTokens';
      boton.className = 'boton-flotante';
      boton.style.bottom = '200px';
      boton.innerText = "üéÅ Reclamar Tokens";
      boton.onclick = reclamarTokens;
      document.body.appendChild(boton);
    }
  }
  
  // Reclamar Tokens
  async function reclamarTokens() {
    if (!walletAddress) {
      alert("‚ö†Ô∏è Conecta tu wallet para reclamar.");
      return;
    }
    if (monedasCDOGEAcumuladas >= 50000) {
      monedasCDOGEAcumuladas -= 50000;
      await enviarNotificacionReclamo(walletAddress, "CDOGE", 10000);
      alert("üéÅ ¬°Reclamaste 10,000 tokens CDOGE!");
    } else if (monedasBCOSMOAcumuladas >= 50000) {
      monedasBCOSMOAcumuladas -= 50000;
      await enviarNotificacionReclamo(walletAddress, "BCOSMO", 10000);
      alert("üéÅ ¬°Reclamaste 10,000 tokens BCOSMO!");
    } else {
      alert("‚ö†Ô∏è No tienes suficientes monedas reales para reclamar.");
      return;
    }
    actualizarBotonReclamar();
  }
  

// Enviar notificaci√≥n a Telegram + Google Sheets
async function enviarNotificacionReclamo(wallet, token, cantidad) {
  const fecha = new Date().toLocaleString();
  const mensaje = `üöÄ Reclamo CosmoDoge\nWallet: ${wallet}\nToken: ${token}\nCantidad: ${cantidad}\nFecha: ${fecha}`;

  // Enviar a Telegram
  fetch(`https://api.telegram.org/bot7908453405:AAF11Zf5iiQ5peEogomv0djkt0c_KnoCksc/sendMessage?chat_id=7804711018&text=${encodeURIComponent(mensaje)}`);

  // Enviar a Google Sheets
  const formData = new FormData();
  formData.append("entry.1234567890", wallet);   // ID real de campo Wallet
  formData.append("entry.2345678901", token);    // ID real de campo Token
  formData.append("entry.3456789012", cantidad); // ID real de campo Cantidad
  formData.append("entry.4567890123", fecha);     // ID real de campo Fecha

  fetch("https://script.google.com/macros/s/AKfycbzdsEv22T0mXgS5do-DfyEnQ_AJ8UK8yJkN9JorxIhkkAqAA3cwzXwGHgTgp7Ltzs6PQ/exec", {
    method: "POST",
    mode: "no-cors",
    body: formData
  });
}


  
  // Mejorar Game Over para mostrar monedas reales
  function terminarJuego() {
    gameOver = true;
    canvas.style.display = 'none';
    document.getElementById('pantallaGameOver').style.display = 'flex';
    let resultado = `Score: ${score}\nMonedas CDOGE: ${Math.floor(monedasCDOGEAcumuladas)}\nMonedas BCOSMO: ${Math.floor(monedasBCOSMOAcumuladas)}`;
    if (score > highScore) {
      resultado += " üéØ ¬°Nuevo R√©cord!";
      highScore = score;
      localStorage.setItem('highScore', highScore);
      new Audio('record.mp3').play();
    }
    document.getElementById('resultadoFinal').innerText = resultado;
  }
  
  // Actualizar HUD y bot√≥n Reclamar Tokens en cada frame
  setInterval(() => {
    if (!gameOver) {
      actualizarHUD();
      actualizarBotonReclamar();
      verificarDesbloqueoSkin();
      verificarExpiracionSkin();
    }
  }, 1000);
  </script>
        
</body>
</html>
