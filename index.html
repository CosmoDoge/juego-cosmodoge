<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CosmoDoge Flotante üöÄ</title>
  <!-- ethers, solana, spl-token -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.41.0/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.5/lib/index.iife.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    html,body{width:100%;height:100%;overflow:hidden;background:black;font-family:Arial;}
    canvas{display:block;margin:auto;max-width:100vw;max-height:100vh;}
    .absolute{position:absolute;color:white;text-shadow:2px 2px 5px #000;z-index:1000;}
    /* HUD */
    #scoreDisplay{top:10px;left:10px;font-size:18px;}
    #coinDisplay{top:40px;left:10px;font-size:18px;}
    #highScoreDisplay{top:70px;left:10px;font-size:18px;}
    #contadorCDOGE{top:100px;left:10px;font:18px Orbitron;color:#0ff;}
    #shieldDisplay{top:130px;left:10px;font:18px Orbitron;color:#faa;}
    #nombreJugador{top:10px;left:50%;transform:translateX(-50%);font:18px Orbitron;color:#0ff;}
    #balanceCDOGE,#balanceBCOSMO{right:20px;padding:10px;border-radius:8px;background:rgba(0,0,0,0.7);font:16px Orbitron;color:#0ff;display:none;}
    #balanceBCOSMO{top:110px;}
    #imanContador{top:150px;right:20px;background:rgba(0,0,0,0.75);padding:8px;border-radius:10px;font:16px Orbitron;color:#0ff;display:none;}
    /* Botones */
    .fixed{position:fixed;z-index:10000;}
    #conectarWalletBtn{top:20px;right:20px;background:#0ff;color:#000;border:none;border-radius:12px;padding:10px 20px;font:16px Orbitron;cursor:pointer;}
    #menuPrincipal{top:70px;right:20px;display:flex;flex-direction:column;gap:10px;}
    #tiendaCDOGE{position:fixed;bottom:20px;left:20px;width:320px;background:rgba(0,0,0,0.85);border:2px solid #0ff;border-radius:15px;padding:15px;display:none;box-shadow:0 0 15px #0ff;font:14px Orbitron;color:#fff;}
    .btn{padding:1rem 2rem;background:#0ff;border:none;border-radius:10px;color:#000;font-size:1.2rem;font-weight:bold;cursor:pointer;transition:background .3s;}
    .btn:hover{background:#0dde;}
    /* Pantallas */
    #pantallaCarga,#startScreen,#newRecordMessage,#gameOverScreen{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);color:white;font:Orbitron;z-index:9999;text-align:center;}
    #pantallaCarga .spinner{width:60px;height:60px;border:6px solid #ffffff22;border-top:6px solid #0ff;border-radius:50%;animation:spin 1s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg);}}
    #gameOverScreen{display:none;opacity:0;transition:opacity 1s;}
    #gameOverScreen.show{display:flex;opacity:1;}
    #reiniciarBtn{margin-top:20px;padding:12px 24px;background:#0ff;color:#000;border:none;border-radius:12px;font-size:18px;cursor:pointer;display:none;}
    #playerNameForm{display:none;flex-direction:column;align-items:center;background:rgba(0,0,0,0.85);padding:20px;border-radius:10px;z-index:10000;}
    #rankingPanel{position:fixed;top:200px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.85);padding:20px;border-radius:10px;display:none;font:14px Orbitron;color:#fff;z-index:10000;}
    #reanudarBtn{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);display:none;padding:15px 30px;font-size:20px;background:#0ff;color:#000;border:none;border-radius:12px;cursor:pointer;z-index:10000;}
  </style>
</head>
<body>
  <!-- Preloader -->
  <div id="pantallaCarga"><div class="spinner"></div><p style="font-size:20px;margin-top:20px;">Iniciando...</p></div>

  <!-- HUD -->
  <button id="conectarWalletBtn" class="fixed">üîó Conectar Wallet</button>
  <div id="balanceCDOGE" class="absolute"></div>
  <div id="balanceBCOSMO" class="absolute"></div>
  <div id="contadorCDOGE" class="absolute">üí∞ CDOGE: 0</div>
  <div id="shieldDisplay" class="absolute">üõ°Ô∏è Escudo: 0</div>
  <div id="imanContador" class="absolute">üß≤ Im√°n: 0</div>
  <div id="scoreDisplay" class="absolute">üöÄ x 0</div>
  <div id="coinDisplay" class="absolute">üí∞ x 0</div>
  <div id="highScoreDisplay" class="absolute">üîù M√°x: 0</div>
  <div id="nombreJugador" class="absolute"></div>

  <!-- Men√∫ -->
  <div id="menuPrincipal" class="fixed">
    <button onclick="toggleTienda()">üõí Tienda</button>
    <button onclick="toggleRanking()">üèÜ Ranking</button>
  </div>

  <!-- Tienda -->
  <div id="tiendaCDOGE">
    <h3 style="color:#0ff;">üõí Tienda CosmoDoge</h3>
    <!-- Im√°n -->
    <div style="margin-bottom:15px;padding:10px;background:#111;border:1px solid #0ff;border-radius:10px;">
      <p style="color:#0ff;">üß≤ Im√°n Espacial</p>
      <p style="color:#bbb;">Atrae monedas 1h</p>
      <button id="comprarIman" style="width:100%;">Comprar 1 500 $CDOGE</button>
    </div>
    <!-- Escudo -->
    <div style="padding:10px;background:#111;border:1px solid #faa;border-radius:10px;">
      <p style="color:#faa;">üõ°Ô∏è Escudo Protector</p>
      <p style="color:#bbb;">Protege 3 colisiones</p>
      <button id="comprarEscudo" style="width:100%;">Comprar 1 000 ü™ô</button>
    </div>
  </div>

  <!-- Canvas -->
  <canvas id="gameCanvas" width="480" height="640"></canvas>

  <!-- Controles -->
  <div id="startScreen" style="display:none;">
    <h1>üöÄ CosmoDoge</h1>
    <button class="btn" id="startButton">¬°Comenzar!</button>
  </div>
  <div id="gameOverScreen">
    <h1>üö® GAME OVER üö®</h1>
    <p>Puntaje: <span id="finalScore">0</span></p>
    <button id="reiniciarBtn" class="btn">Reiniciar</button>
  </div>
  <div id="newRecordMessage" style="display:none;">
    <h1>üåü Nuevo r√©cord</h1>
  </div>

  <!-- Formulario y Ranking -->
  <div id="playerNameForm">
    <input type="text" id="playerName" placeholder="Tu nombre gal√°ctico" style="padding:10px;border-radius:8px;border:none;margin-bottom:10px;">
    <button class="btn" id="saveScoreButton">Guardar Puntaje</button>
  </div>
  <div id="rankingPanel">
    <div id="topRanking"></div>
    <button class="btn" onclick="toggleRanking()">Cerrar</button>
  </div>

  <button id="reanudarBtn" class="btn">Reanudar Juego</button>

  <!-- Firebase + L√≥gica -->
  <script type="module">
    window.addEventListener('error', e=>console.error('Error:',e.message));
    window.addEventListener('unhandledrejection', e=>console.error('Rechazo:',e.reason));

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, query, orderBy, limit, getDocs, addDoc, serverTimestamp }
      from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDaM9HtMtTlJXc-V4HfsZ7bbC__ZPe9zIk",
      authDomain: "cosmodogelive.firebaseapp.com",
      projectId: "cosmodogelive",
      storageBucket: "cosmodogelive.appspot.com",
      messagingSenderId: "648227069914",
      appId: "1:648227069914:web:3ef7ac8da4ab52c30deae3"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.guardarJugadorAutomatic = async (user,pts,mns) => {
      try{
        await addDoc(collection(db,"jugadores"),{
          nombre:String(user), puntaje:Number(pts), monedas:Number(mns),
          fecha: serverTimestamp()
        });
      }catch(e){ console.error("Firestore:",e); }
    };
    window.mostrarTopRanking = async () => {
      const lista = document.getElementById("topRanking");
      try{
        const q= query(collection(db,"jugadores"),orderBy("puntaje","desc"),limit(5));
        const snap=await getDocs(q);
        let html="<h2>üèÜ Top 5</h2><ul style='list-style:none;padding:0;'>";
        snap.forEach((d,i)=>html+=`<li>#${i+1} <strong>${d.data().nombre}</strong> - ${d.data().puntaje} pts</li>`);
        lista.innerHTML=html+"</ul>";
      }catch(e){ lista.innerHTML="<p style='color:red;'>ERROR ranking</p>"; }
    };
  </script>

  <script>
    // Variables globales
    const canvas=document.getElementById("gameCanvas"), ctx=canvas.getContext("2d");
    const esMovil=/Mobi|Android/i.test(navigator.userAgent);

    let score=0, coins=parseInt(localStorage.getItem("cdogeCoins"))||0;
    let highScore=parseInt(localStorage.getItem("cdogeFloatHighScore"))||0;
    let totalCDOGE=parseInt(localStorage.getItem("cdogeTotalCoins"))||0;
    let shieldCount=parseInt(localStorage.getItem("shieldCount"))||0;
    let gameStarted=false,isGameOver=false;
    let timeElapsed=0,lastScoreTime=0,lastFondoChange=0,lastObs=Date.now();
    let gravityLevels=[0.5,0.6,0.8,1.0], gravity=0.5, jump=-10;

    let coinsArr=[], obsArr=[], cdogeArr=[], bcosmoArr=[];
    const valorC=50, valorB=50;
    const ubics=[{x:80,y:100},{x:canvas.width-120,y:80},{x:canvas.width/2,y:canvas.height/3},{x:canvas.width-80,y:canvas.height-120},{x:100,y:canvas.height-150}];
    const fondos=["fondo1.png","fondo2.png","fondo3.png"]; let fi=0;
    const fondo=new Image(); fondo.src=fondos[0];
    const doge={x:80,y:200,w:50,h:50,v:0,img:new Image()}; doge.img.src="cosmo.png";
    const coinImg=new Image(); coinImg.src="coin.png";
    const obsImgs=["obs1.png","obs2.png","obs3.png"];
    const mImg=new Image(); mImg.src="monedaC.png";
    const bImg=new Image(); bImg.src="monedaB.png";

    const sndJ=new Audio("jump.mp3"), sndC=new Audio("coin.mp3"),
          sndB=new Audio("boom.mp3"), sndR=new Audio("record.mp3");
    const sC=new Audio("monedaC.mp3"), sB=new Audio("monedaB.mp3");
    const music=new Audio("theme.mp3"); music.loop=true; music.volume=0.3;

    // On-chain IDs
    const CDOGE_CON="0x5dE25281305992d3552a45A3D8ccA7BdfB4AcD3A";
    const ABI=["function balanceOf(address)view returns(uint256)","function decimals()view returns(uint8)","function transfer(address,uint256)returns(bool)"];
    const RCP="0x1980dCdDA07071970dEAa69c975F590976Ee667D3A".toLowerCase();

    const MINT="2etLM91LBaxbQ1y3jnzQw8EXKNHAKcXJsHMJJ69opump";
    const RCV="A6dnVgGaS1scC2m6hmPdK15D5gs5vDsHS8PEq3xtJKNx";

    // Utils
    function play(s){s.currentTime=0;s.play().catch(()=>{});}
    function showMsg(t,x,y){
      const d=document.createElement("div");
      Object.assign(d.style,{position:"absolute",left:`${x}px`,top:`${y}px`,color:"#0ff",font:"18px Orbitron",zIndex:10000,transition:"all 1.5s"});
      d.textContent=t;document.body.appendChild(d);
      setTimeout(()=>{d.style.opacity="0";d.style.transform="translateY(-40px)";},100);
      setTimeout(()=>d.remove(),1600);
    }
    function updCDOGE(){document.getElementById("contadorCDOGE").textContent=`üí∞ CDOGE: ${totalCDOGE}`;}
    function updShield(){document.getElementById("shieldDisplay").textContent=`üõ°Ô∏è Escudo: ${shieldCount}`;}

    function updDiff(s){gravity= s>=75?1.0: s>=45?0.8: s>=30?0.6:0.5;}

    // Im√°n
    let imanA=false,aura=false;
    function actIman(){
      const exp=Date.now()+3600000;
      localStorage.setItem("imanExpiracion",exp);
      imanA=true; aura=true; showMsg("üß≤ Im√°n 1h",canvas.width/2,100);
      setInterval(updIman,1000);
    }
    function chkIman(){
      const id=setInterval(()=>{
        const exp=parseInt(localStorage.getItem("imanExpiracion"))||0;
        if(Date.now()>=exp){imanA=false;aura=false;localStorage.removeItem("imanExpiracion");clearInterval(id);showMsg("‚è±Ô∏è Im√°n expir√≥",canvas.width/2,100);}
      },1000);
    }
    function updIman(){
      const d=document.getElementById("imanContador");
      const exp=parseInt(localStorage.getItem("imanExpiracion"))||0;
      const r=exp-Date.now();
      if(r>0){const m=Math.floor(r/60000),s=Math.floor((r%60000)/1000);d.textContent=`üß≤ Im√°n: ${m}:${s<10?'0':''}${s}`;d.style.display="block";}
      else d.style.display="none";
    }
    function drawAura(d){
      if(aura){ctx.beginPath();ctx.arc(d.x+d.w/2,d.y+d.h/2,d.w*0.8,0,Math.PI*2);ctx.strokeStyle="#00ffff88";ctx.lineWidth=4;ctx.stroke();}
    }

    // Escudo
    function buyShield(){
      if(coins<1000) return alert("No tienes ü™ô suficientes");
      coins-=1000;localStorage.setItem("cdogeCoins",coins);
      document.getElementById("coinDisplay").textContent=`üí∞ x ${coins}`;
      shieldCount=3;localStorage.setItem("shieldCount",3);
      updShield();showMsg("üõ°Ô∏è Escudo adquirido (3)",canvas.width/2,140);
    }

    // Conexi√≥n Wallet
    async function conectarMetaMask(){
      const isM=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      if(typeof window.ethereum==="undefined"){
        if(isM) return window.location.href=`https://metamask.app.link/dapp/${encodeURIComponent(window.location.href)}`;
        return alert("Instala MetaMask");
      }
      try{
        const acc=await window.ethereum.request({method:"eth_requestAccounts"});
        const acct=acc[0];
        document.getElementById("conectarWalletBtn").textContent=`üîó ${acct.slice(0,6)}‚Ä¶${acct.slice(-4)}`;
        const prov=new ethers.providers.Web3Provider(window.ethereum);
        const c=new ethers.Contract(CDOGE_CON,ABI,prov);
        const b=await c.balanceOf(acct),d=await c.decimals();
        const fmt=Number(b/10**d).toLocaleString();
        document.getElementById("balanceCDOGE").innerHTML=`üöÄ ${fmt} $CDOGE`;document.getElementById("balanceCDOGE").style.display="block";
      }catch(e){console.error(e);alert("Error MetaMask");}
    }
    async function conectarPhantom(){
      try{
        const p=window.solana;
        if(!p||!p.isPhantom) throw new Error("Instala Phantom");
        const resp=await p.connect();
        const addr=resp.publicKey.toString();
        showMsg(`üåê Phantom: ${addr.slice(0,6)}‚Ä¶${addr.slice(-4)}`,canvas.width/2,80);
        const conn=new solanaWeb3.Connection("https://api.mainnet-beta.solana.com","confirmed");
        const respAcc=await conn.getParsedTokenAccountsByOwner(resp.publicKey,{programId:solanaWeb3.TOKEN_PROGRAM_ID});
        let bal=0;
        respAcc.value.forEach(({account})=>{
          const info=account.data.parsed.info;
          if(info.mint===MINT) bal=info.tokenAmount.uiAmount;
        });
        document.getElementById("balanceBCOSMO").innerHTML=`üêï ${bal||0} BCOSMO`;
        document.getElementById("balanceBCOSMO").style.display="block";
      }catch(e){console.error(e);alert(e.message);}
    }

    function mostrarSelectorWallet(){
      const opt=prompt("1-MetaMask\n2-Phantom");
      if(opt==="1") conectarMetaMask();
      else if(opt==="2") conectarPhantom();
      else alert("Inv√°lido");
    }

    // Compras On-chain Im√°n
    async function comprarImanCDOGE(){
      const isM=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      if(typeof window.ethereum==="undefined"){
        if(isM) return window.location.href=`https://metamask.app.link/dapp/${encodeURIComponent(window.location.href)}`;
        return alert("Instala MetaMask");
      }
      try{
        const acc=await window.ethereum.request({method:'eth_requestAccounts'});
        const prov=new ethers.providers.Web3Provider(window.ethereum);
        const s=prov.getSigner();
        const c=new ethers.Contract(CDOGE_CON,ABI,s);
        const d=await c.decimals();
        const amt=ethers.utils.parseUnits("1500",d);
        const tx=await c.transfer(RCP,amt);
        await tx.wait();
        actIman(); chkIman(); showMsg("üß≤ Im√°n comprado",canvas.width/2,100);
      }catch(e){console.error(e);alert("Error comprando Im√°n");}
    }

    async function comprarImanBCOSMO(){
      try{
        const p=window.solana;
        if(!p||!p.isPhantom) throw new Error("Instala Phantom");
        const resp=await p.connect();
        const wp=resp.publicKey;
        const conn=new solanaWeb3.Connection("https://api.mainnet-beta.solana.com","confirmed");
        const mintPub=new solanaWeb3.PublicKey(MINT);
        const recPub=new solanaWeb3.PublicKey(RCV);
        const mi=await conn.getParsedAccountInfo(mintPub);
        const dec=mi.value.data.parsed.info.decimals;
        const sAcc=await splToken.getOrCreateAssociatedTokenAccount(conn,wp,mintPub,wp);
        const rAcc=await splToken.getOrCreateAssociatedTokenAccount(conn,wp,mintPub,recPub);
        const amount=2500*(10**dec);
        const ix=splToken.createTransferCheckedInstruction(sAcc.address,mintPub,rAcc.address,wp,amount,dec);
        const tx=new solanaWeb3.Transaction().add(ix);
        tx.feePayer=wp;
        tx.recentBlockhash=(await conn.getRecentBlockhash()).blockhash;
        const signed=await p.signTransaction(tx);
        const sig=await conn.sendRawTransaction(signed.serialize());
        await conn.confirmTransaction(sig);
        actIman(); chkIman(); showMsg("üß≤ Im√°n comprado",canvas.width/2,120);
      }catch(e){console.error(e);alert("Error comprando Im√°n");}
    }

    // Escudo inmune colisiones
    function handleCollision(){
      if(shieldCount>0){
        shieldCount--; localStorage.setItem("shieldCount",shieldCount);
        updShield();
        showMsg(`üõ°Ô∏è Escudo usado, quedan ${shieldCount}`,canvas.width/2,160);
        return true; // colisi√≥n consumida
      }
      return false;
    }

    // Spawn & draw
    function spawnCoins(){ /* igual que antes... */ }
    function drawCoins(){ /* igual, con im√°n... */ }
    function spawnObs(){ /* igual... */ }
    function drawObs(){
      obsArr.forEach(o=>{
        o.x-=o.speedX; o.y+=(o.y<doge.y?o.speedY:-o.speedY);
        ctx.drawImage(o.img,o.x,o.y,o.w,o.h);
        if(doge.x<o.x+o.w&&doge.x+doge.w>o.x&&doge.y<o.y+o.h&&doge.y+doge.h>o.y){
          if(!handleCollision()) gameOver();
        }
      });
      obsArr=obsArr.filter(o=>o.x+o.w>0);
    }

    function drawBg(){ctx.drawImage(fondo,0,0,canvas.width,canvas.height);}
    function drawD(){ctx.drawImage(doge.img,doge.x,doge.y,doge.w,doge.h);drawAura(doge);}

    // Bucle
    let lt=0;
    function loop(ts){
      if(isGameOver) return;
      if(!lt) lt=ts; const dt=ts-lt; lt=ts;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawBg();
      doge.v+=gravity*(dt/16); doge.y+=doge.v*(dt/16);
      if(doge.y+doge.h>=canvas.height||doge.y<=0){ if(!handleCollision()) return gameOver(); else doge.y=canvas.height/2; }
      drawD(); drawCoins(); drawObs(); /* monedas especiales... */
      timeElapsed+=dt; const sec=timeElapsed/1000;
      if(sec-lastScoreTime>=5){ score++; lastScoreTime=sec; document.getElementById("scoreDisplay").textContent=`üöÄ x ${score}`;}
      if(sec-lastFondoChange>=30){ fi=(fi+1)%fondos.length; fondo.src=fondos[fi]; lastFondoChange=sec;}
      if(Math.floor(timeElapsed/16)%150===0) spawnCoins();
      const now=Date.now(),interval=(timeElapsed/16)>=3600?1000:(timeElapsed/16)>=1800?2000:3000;
      if(now-lastObs>=interval){ spawnObs(); lastObs=now;}
      updDiff(sec);
      requestAnimationFrame(loop);
    }

    function gameOver(){
      isGameOver=true;
      music.pause();music.currentTime=0;
      document.getElementById("finalScore").textContent=score;
      const go=document.getElementById("gameOverScreen");
      go.style.display="flex"; setTimeout(()=>go.classList.add("show"),10);
      setTimeout(()=>document.getElementById("reiniciarBtn").style.display="block",1500);
      if(score>highScore){
        localStorage.setItem("cdogeFloatHighScore",score);
        highScore=score; document.getElementById("highScoreDisplay").textContent=`üîù M√°x: ${highScore}`;
        document.getElementById("newRecordMessage").style.display="flex";
        play(sndR);
        const u=localStorage.getItem("cosmodogeliveUserName");
        if(!u) document.getElementById("playerNameForm").style.display="flex";
        else guardarJugadorAutomatic(u,score,coins).then(mostrarTopRanking);
      } else play(sndB);
    }

    document.getElementById("startButton").onclick=()=>{
      document.getElementById("pantallaCarga").style.display="none";
      document.getElementById("startScreen").style.display="none";
      document.getElementById("menuPrincipal").style.display="none";
      gameStarted=true; music.play(); requestAnimationFrame(loop);
    };
    document.getElementById("reiniciarBtn").onclick=()=>location.reload();

    document.getElementById("saveScoreButton").onclick=()=>{
      const n=document.getElementById("playerName").value.trim();
      if(!n) return alert("Ingresa nombre");
      localStorage.setItem("cosmodogeliveUserName",n);
      document.getElementById("playerNameForm").style.display="none";
      guardarJugadorAutomatic(n,score,coins).then(mostrarTopRanking);
    };

    document.getElementById("comprarEscudo").onclick=buyShield;
    document.getElementById("comprarIman").onclick=comprarImanCDOGE;
    document.getElementById("comprarImanBCOSMO").onclick=comprarImanBCOSMO;
    document.getElementById("conectarWalletBtn").onclick=mostrarSelectorWallet;

    document.addEventListener("keydown",e=>{if(e.code==="Space"&&gameStarted&&!isGameOver){doge.v=jump;play(sndJ);}});

    document.addEventListener("visibilitychange",()=>{
      if(document.hidden&&gameStarted&&!isGameOver){cancelAnimationFrame(loop);document.getElementById("reanudarBtn").style.display="block";}
    });
    document.getElementById("reanudarBtn").onclick=()=>{
      document.getElementById("reanudarBtn").style.display="none";
      if(!isGameOver) requestAnimationFrame(loop);
    };

    window.addEventListener("DOMContentLoaded",()=>{
      setTimeout(()=>document.getElementById("pantallaCarga").style.display="none",3000);
      document.getElementById("startScreen").style.display="flex";
      document.getElementById("coinDisplay").textContent=`üí∞ x ${coins}`;
      document.getElementById("highScoreDisplay").textContent=`üîù M√°x: ${highScore}`;
      updShield(); updCDOGE();
      const u=localStorage.getItem("cosmodogeliveUserName");
      if(u){document.getElementById("nombreJugador").textContent=`üê∂ ${u}`;mostrarTopRanking();}
      chkIman();
    });

    function toggleTienda(){const t=document.getElementById("tiendaCDOGE");t.style.display=(t.style.display==="block"?"none":"block");}
    function toggleRanking(){
      const r=document.getElementById("rankingPanel");
      if(r.style.display==="block") r.style.display="none";
      else{mostrarTopRanking(); r.style.display="block";}
    }
  </script>
</body>
</html>
