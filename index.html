<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CosmoDoge Flotante üöÄ</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.41.0/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@0.3.5/lib/index.iife.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: black; font-family: 'Orbitron', sans-serif; }
    canvas { display: block; margin: auto; max-width: 100vw; max-height: 100vh; }
    button { font-family: 'Orbitron', sans-serif; }
    #pantallaCarga {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: black; display: flex; flex-direction: column; align-items: center; justify-content: center;
      z-index: 9999; color: white; font-size: 20px;
    }
    .spinner {
      width: 60px; height: 60px; border: 6px solid #ffffff22; border-top: 6px solid #0ff;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    #startScreen {
      display: none; flex-direction: column; align-items: center; justify-content: center;
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      overflow: hidden; background: black; z-index: 9000;
    }
    #startBackground {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: url('fondo-cosmodoge-inicio.png') repeat; background-size: cover;
      animation: scrollBg 60s linear infinite;
    }
    @keyframes scrollBg {
      0% { background-position: 0 0; }
      100% { background-position: 0 1000px; }
    }
    #tituloInicio {
      z-index: 2; color: #0ff; font-size: 48px; text-shadow: 0 0 20px #0ff;
      animation: aparecer 2s ease forwards;
    }
    @keyframes aparecer {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }
    #dogeInicio {
      z-index: 2; width: 100px; margin-top: 30px;
      animation: flotar 3s ease-in-out infinite;
    }
    @keyframes flotar {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    #startButton {
      z-index: 2; margin-top: 40px; padding: 12px 24px;
      background: #0ff; color: black; border: none; border-radius: 12px;
      font-weight: bold; font-size: 18px; cursor: pointer;
    }
    .hud {
      position: absolute; color: white; text-shadow: 2px 2px 5px #000;
      z-index: 1000; font: 18px 'Orbitron', sans-serif;
    }
    #scoreDisplay { top: 10px; left: 10px; }
    #coinDisplay { top: 40px; left: 10px; }
    #highScoreDisplay { top: 70px; left: 10px; }
    #contadorCDOGE { top: 100px; left: 10px; color: #0ff; }
    #contadorBCOSMO { top: 130px; left: 10px; color: #faa200; }
    #shieldDisplay { top: 160px; left: 10px; color: #faa; display: none; }
    #nombreJugador { top: 10px; left: 50%; transform: translateX(-50%); color: #0ff; }
    #imanContador {
      position: absolute; top: 190px; right: 20px; padding: 8px; border-radius: 10px;
      background: rgba(0,0,0,0.75); font: 16px 'Orbitron', sans-serif; color: #0ff; display: none; z-index: 1000;
    }
    #escudoAura {
      position: absolute; width: 80px; height: 80px; border: 3px dashed #fff;
      border-radius: 50%; opacity: 0.6; animation: escudoAnim 1s infinite alternate;
      display: none; pointer-events: none; z-index: 1001;
    }
    @keyframes escudoAnim {
      0% { transform: scale(1); opacity: 0.6; }
      100% { transform: scale(1.2); opacity: 1; }
    }
    .fixed { position: fixed; z-index: 10000; transition: opacity .3s; }
    .hiddenUI { opacity: 0; }
    #conectarWalletBtn {
      top: 20px; right: 20px; background: #0ff; color: #000; border: none;
      border-radius: 12px; padding: 10px 20px; font: 16px 'Orbitron', sans-serif; cursor: pointer;
    }
    #menuPrincipal {
      top: 70px; right: 20px; display: flex; flex-direction: column; gap: 10px;
    }
    #tiendaCDOGE, #rankingPanel {
      position: fixed; background: rgba(0,0,0,0.85); padding: 15px;
      border-radius: 15px; box-shadow: 0 0 15px #0ff;
      font: 14px 'Orbitron', sans-serif; color: #fff;
      z-index: 10001; display: none;
    }
    #tiendaCDOGE { bottom: 20px; left: 20px; width: 320px; border: 2px solid #0ff; }
    #rankingPanel { top: 200px; left: 50%; transform: translateX(-50%); }
    .btn {
      padding: 1rem 2rem; background: #0ff; border: none; border-radius: 10px;
      color: #000; font-size: 1.2rem; font-weight: bold; cursor: pointer;
      transition: transform .2s, box-shadow .2s;
    }
    .btn:hover { transform: scale(1.05); box-shadow: 0 0 10px #0ff; }
  </style>
</head>
<body>
<!-- Pantalla de carga -->
<div id="pantallaCarga">
  <div class="spinner"></div>
  <p>Cargando CosmoDoge...</p>
</div>

<!-- Pantalla de inicio -->
<div id="startScreen">
  <div id="startBackground"></div>
  <h1 id="tituloInicio">üöÄ CosmoDoge Flotante üöÄ</h1>
  <img id="dogeInicio" src="cosmodoge-cohete-juego.png" />
  <button id="startButton" class="btn">¬°Comenzar!</button>
</div>

<!-- HUD principal -->
<div id="balanceCDOGE" class="hud"></div>
<div id="balanceBCOSMO" class="hud"></div>
<div id="scoreDisplay" class="hud">üöÄ x 0</div>
<div id="coinDisplay" class="hud">üí∞ x 0</div>
<div id="highScoreDisplay" class="hud">üîù M√°x: 0</div>
<div id="contadorCDOGE" class="hud">üí∞ CDOGE: 0</div>
<div id="contadorBCOSMO" class="hud">üêï BCOSMO: 0</div>
<div id="shieldDisplay" class="hud"></div>
<div id="nombreJugador" class="hud"></div>
<div id="imanContador" class="hud"></div>
<div id="escudoAura"></div>

<!-- Bot√≥n de Wallet -->
<button id="conectarWalletBtn" class="fixed">üîó Conectar Wallet</button>

<!-- Men√∫ principal -->
<div id="menuPrincipal" class="fixed">
  <button id="btnTienda" class="btn">üõí Tienda</button>
  <button id="btnRanking" class="btn">üèÜ Ranking</button>
</div>

<!-- Tienda -->
<div id="tiendaCDOGE">
  <h3 style="color:#0ff;">üõí Tienda CosmoDoge</h3>
  <div style="margin-bottom:15px;padding:10px;background:#111;border:1px solid #0ff;border-radius:10px;">
    <p style="color:#0ff;">üß≤ Im√°n Espacial (CDOGE)</p>
    <p style="color:#bbb;">Atrae monedas 1h</p>
    <button id="comprarImanCDOGE" class="btn">Comprar 1,500 $CDOGE</button>
  </div>
  <div style="margin-bottom:15px;padding:10px;background:#111;border:1px solid #0ff;border-radius:10px;">
    <p style="color:#0ff;">üß≤ Im√°n Espacial (BCOSMO)</p>
    <p style="color:#bbb;">Atrae monedas 1h</p>
    <button id="comprarImanBCOSMO" class="btn">Comprar 2,500 $BCOSMO</button>
  </div>
  <div style="padding:10px;background:#111;border:1px solid #faa;border-radius:10px;">
    <p style="color:#faa;">üõ°Ô∏è Escudo Protector</p>
    <p style="color:#bbb;">Inmune a 3 golpes</p>
    <button id="comprarEscudo" class="btn">Comprar 1,000 ü™ô</button>
  </div>
</div>

<!-- Ranking -->
<div id="rankingPanel">
  <div id="topRanking"></div>
  <button id="closeRanking" class="btn">Cerrar</button>
</div>

<!-- Pantalla Game Over -->
<div id="gameOverScreen" style="display:none;">
  <h1>üö® GAME OVER üö®</h1>
  <p>Puntaje: <span id="finalScore">0</span></p>
  <button id="reiniciarBtn" class="btn">Reiniciar</button>
</div>

<!-- Formulario Nombre Jugador -->
<div id="newRecordMessage" style="display:none;">
  <h1>üåü ¬°Nuevo r√©cord gal√°ctico!</h1>
  <p>Ingresa tu nombre para guardarlo.</p>
</div>
<div id="playerNameForm" style="display:none;flex-direction:column;align-items:center;background:rgba(0,0,0,0.85);padding:20px;border-radius:10px;z-index:10000;">
  <input type="text" id="playerName" placeholder="Tu nombre gal√°ctico" style="padding:10px;border:none;border-radius:8px;margin-bottom:10px;" />
  <button id="saveScoreButton" class="btn">Guardar Puntaje</button>
</div>

<!-- Canvas principal del juego -->
<canvas id="gameCanvas"></canvas>
<script type="module">
  /* ===================== CONFIGURACI√ìN E INICIO ===================== */
  let gameStarted = false, isGameOver = false;
  let score = 0, coins = 0, highScore = 0, totalCDOGE = 0, totalBCOSMO = 0;
  let lastFondoChange = 0, lastScoreTime = 0, timeElapsed = 0;
  let gravity = 0.5, jumpPower = -10, fondoIndex = 0;
  
  const fondos = ['fondo-cosmodoge-v2.png', 'fondo-cosmodoge-v3.png', 'fondo-cosmodoge-v4.png'];
  const fondoImg = new Image(); fondoImg.src = fondos[0];
  
  const doge = { x: 80, y: 200, w: 50, h: 50, v: 0, img: new Image() };
  const skinActual = localStorage.getItem('skinCosmo') || 'default';
  doge.img.src = (skinActual === 'astronauta') ? 'cosmodoge-skin-astronauta.png' : 'cosmodoge-cohete-juego.png';
  
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  window.addEventListener('resize', resizeCanvas); resizeCanvas();
  
  // Arrays
  let coinsArr = [], obsArr = [], cofresArr = [], agujeroArr = [];
  
  // Sonidos
  const sndJump = new Audio('jump.mp3');
  const sndCoin = new Audio('coin.mp3');
  const sndBoom = new Audio('boom.mp3');
  const sndRecord = new Audio('record.mp3');
  const music = new Audio('music-cosmodoge-theme.mp3'); music.loop = true; music.volume = 0.3;
  
  /* ===================== FUNCIONES GENERALES ===================== */
  function play(sound) { sound.currentTime = 0; sound.play().catch(() => {}); }
  
  function showMsg(txt, x, y) {
    const d = document.createElement('div');
    Object.assign(d.style, {position:'absolute',left:`${x}px`,top:`${y}px`,color:'#0ff',font:'18px Orbitron',zIndex:10000,transition:'all 1.5s'});
    d.textContent = txt;
    document.body.appendChild(d);
    setTimeout(() => { d.style.opacity = 0; d.style.transform = 'translateY(-40px)'; }, 100);
    setTimeout(() => d.remove(), 1600);
  }
  
  function updHUD() {
    document.getElementById('coinDisplay').textContent = `üí∞ x ${coins}`;
    document.getElementById('scoreDisplay').textContent = `üöÄ x ${score}`;
    document.getElementById('contadorCDOGE').textContent = `üí∞ CDOGE: ${totalCDOGE}`;
    document.getElementById('contadorBCOSMO').textContent = `üêï BCOSMO: ${totalBCOSMO}`;
    document.getElementById('highScoreDisplay').textContent = `üîù M√°x: ${highScore}`;
  }
  
  /* ===================== MOTOR DEL DOGE ===================== */
  function drawAuraIman() {
    const exp = parseInt(localStorage.getItem('imanExpiracion')) || 0;
    if (Date.now() < exp) {
      ctx.beginPath();
      ctx.arc(doge.x + doge.w/2, doge.y + doge.h/2, doge.w * 0.8, 0, Math.PI * 2);
      ctx.strokeStyle = '#0ffff088';
      ctx.lineWidth = 4;
      ctx.stroke();
    }
  }
  
  function drawEscudoAura() {
    const cargas = parseInt(localStorage.getItem('escudoCargas')) || 0;
    if (cargas > 0) {
      ctx.beginPath();
      ctx.arc(doge.x + doge.w/2, doge.y + doge.h/2, doge.w * 1.2, 0, Math.PI * 2);
      ctx.strokeStyle = '#ffff0088';
      ctx.lineWidth = 3;
      ctx.stroke();
    }
  }
  
  function drawDoge() {
    ctx.drawImage(doge.img, doge.x, doge.y, doge.w, doge.h);
    drawAuraIman();
    drawEscudoAura();
  }
  
  /* ===================== M√ÅS FUNCIONES DE JUEGO (seguir√°n en PARTE 4) ===================== */
  </script>
<script type="module">
  /* ===================== MONEDAS ===================== */
  function spawnCoinGroup() {
    const amount = Math.floor(Math.random() * 6) + 5;
    for (let i = 0; i < amount; i++) {
      coinsArr.push({ x: canvas.width + i * 40, y: Math.random() * (canvas.height - 100), w: 30, h: 30, s: 2 });
    }
  }
  
  function drawCoins() {
    for (let i = coinsArr.length - 1; i >= 0; i--) {
      const c = coinsArr[i];
      c.x -= c.s;
      ctx.drawImage(coinImg, c.x, c.y, c.w, c.h);
      if (doge.x < c.x + c.w && doge.x + doge.w > c.x && doge.y < c.y + c.h && doge.y + doge.h > c.y) {
        coins++;
        localStorage.setItem('cdogeCoins', coins);
        coinsArr.splice(i, 1);
        play(sndCoin);
        updHUD();
      }
      if (c.x + c.w < 0) coinsArr.splice(i, 1);
    }
  }
  
  /* ===================== OBST√ÅCULOS ===================== */
  function spawnObstacle() {
    const img = new Image();
    img.src = obsImgs[Math.floor(Math.random() * obsImgs.length)];
    obsArr.push({ x: canvas.width, y: Math.random() * (canvas.height - 50), w: 50, h: 50, sX: 2 + Math.random() * 2, sY: 0.5 + Math.random() });
  }
  
  function drawObstacles() {
    obsArr.forEach((o) => {
      o.x -= o.sX;
      o.y += (o.y < doge.y ? o.sY : -o.sY);
      ctx.drawImage(o.img, o.x, o.y, o.w, o.h);
      if (doge.x < o.x + o.w && doge.x + doge.w > o.x && doge.y < o.y + o.h && doge.y + doge.h > o.y) {
        if (!usarCargaEscudo()) gameOver();
      }
    });
    obsArr = obsArr.filter(o => o.x + o.w > 0);
  }
  
  /* ===================== COFRES ===================== */
  function spawnCofre() {
    if (timeElapsed / 1000 > 45 && Math.random() < 0.25 && cofresArr.length < 1) {
      cofresArr.push({ x: canvas.width, y: Math.random() * (canvas.height - 100), w: 50, h: 50, s: 2 });
    }
  }
  
  function drawCofres() {
    for (let i = cofresArr.length - 1; i >= 0; i--) {
      const c = cofresArr[i];
      c.x -= c.s;
      ctx.drawImage(cofreImg, c.x, c.y, c.w, c.h);
      if (doge.x < c.x + c.w && doge.x + doge.w > c.x && doge.y < c.y + c.h && doge.y + doge.h > c.y) {
        cofresArr.splice(i, 1);
        play(sndCoin);
        if (Math.random() < 0.5) activarImanCofre();
        else activarEscudoCofre();
      }
      if (c.x + c.w < 0) cofresArr.splice(i, 1);
    }
  }
  
  function activarImanCofre() {
    showMsg('üß≤ ¬°Im√°n gratis!', canvas.width / 2, 100);
    localStorage.setItem('imanExpiracion', Date.now() + 300000); // 5 minutos
  }
  
  function activarEscudoCofre() {
    showMsg('üõ°Ô∏è ¬°Escudo gratis!', canvas.width / 2, 140);
    agregarCargaEscudo();
  }
  
  /* ===================== AGUJERO NEGRO ===================== */
  function spawnAgujero() {
    if (timeElapsed / 1000 > 15 && Math.random() < 0.15 && agujeroArr.length < 1) {
      agujeroArr.push({ x: canvas.width, y: Math.random() * (canvas.height - 150), w: 80, h: 80, s: 1 });
    }
  }
  
  function drawAgujeros() {
    for (let i = agujeroArr.length - 1; i >= 0; i--) {
      const a = agujeroArr[i];
      a.x -= a.s;
      ctx.drawImage(agujeroImg, a.x, a.y, a.w, a.h);
      absorverCercanos(a);
      if (doge.x < a.x + a.w && doge.x + doge.w > a.x && doge.y < a.y + a.h && doge.y + doge.h > a.y) {
        if (!usarCargaEscudo()) gameOverEspecial();
      }
      if (a.x + a.w < 0) agujeroArr.splice(i, 1);
    }
  }
  
  function absorverCercanos(a) {
    [...coinsArr, ...obsArr].forEach(obj => {
      const dx = a.x + 40 - (obj.x + obj.w / 2);
      const dy = a.y + 40 - (obj.y + obj.h / 2);
      const dist = Math.hypot(dx, dy);
      if (dist < 200) { obj.x -= dx * 0.01; obj.y -= dy * 0.01; }
    });
  }
  </script>
<script type="module">
  /* ===================== SISTEMA DE ESCUDO ===================== */
  function agregarCargaEscudo() {
    let cargas = parseInt(localStorage.getItem('escudoCargas')) || 0;
    localStorage.setItem('escudoCargas', cargas + 1);
  }
  
  function usarCargaEscudo() {
    let cargas = parseInt(localStorage.getItem('escudoCargas')) || 0;
    if (cargas > 1) {
      localStorage.setItem('escudoCargas', cargas - 1);
      showMsg('üõ°Ô∏è Escudo absorbi√≥ da√±o', canvas.width / 2, 160);
      return true;
    } else {
      localStorage.setItem('escudoCargas', 0);
      return false;
    }
  }
  
  function checkShield() {
    const d = document.getElementById('shieldDisplay');
    let cargas = parseInt(localStorage.getItem('escudoCargas')) || 0;
    if (cargas > 0) {
      d.style.display = 'block';
      d.textContent = `üõ°Ô∏è Escudo: ${cargas}`;
    } else {
      d.style.display = 'none';
    }
  }
  
  /* ===================== GAME OVER NORMAL Y ESPECIAL ===================== */
  function gameOver() {
    window.isGameOver = true;
    music.pause();
    music.currentTime = 0;
    document.getElementById('finalScore').textContent = score;
    document.getElementById('gameOverScreen').style.display = 'flex';
    
    if (score > highScore) {
      localStorage.setItem('cdogeFloatHighScore', score);
      document.getElementById('newRecordMessage').style.display = 'flex';
      guardarJugadorAutomatic(localStorage.getItem('cosmodogeliveUserName') || "Jugador", score, coins).then(mostrarTopRanking);
      play(sndRecord);
    } else {
      play(sndBoom);
    }
  }
  
  function gameOverEspecial() {
    window.isGameOver = true;
    music.pause();
    music.currentTime = 0;
    alert('üåë ¬°El Agujero Negro te absorbi√≥!');
    location.reload();
  }
  
  /* ===================== LOOP PRINCIPAL DEL JUEGO ===================== */
  let lastTs = 0;
  function loop(ts) {
    if (!window.gameStarted || window.isGameOver) return;
    if (!lastTs) lastTs = ts;
    const dt = ts - lastTs;
    lastTs = ts;
    timeElapsed += dt;
  
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(fondoImg, 0, 0, canvas.width, canvas.height);
  
    doge.v += gravity * (dt / 16);
    doge.y += doge.v * (dt / 16);
  
    if (doge.y + doge.h >= canvas.height || doge.y <= 0) {
      if (!usarCargaEscudo()) return gameOver();
      doge.y = canvas.height / 2;
    }
  
    drawDoge();
    drawCoins();
    drawObstacles();
    drawCofres();
    drawAgujeros();
    checkShield();
  
    if (timeElapsed / 1000 - lastScoreTime >= 5) {
      score++;
      lastScoreTime = timeElapsed / 1000;
      updHUD();
    }
  
    if (Math.floor(timeElapsed / 16) % 180 === 0) spawnCoinGroup();
    if (Math.floor(timeElapsed / 16) % 250 === 0) spawnObstacle();
    if (Math.floor(timeElapsed / 16) % 400 === 0) spawnCofre();
    if (Math.floor(timeElapsed / 16) % 500 === 0) spawnAgujero();
  
    if (timeElapsed / 1000 - lastFondoChange >= 30) {
      fi = (fi + 1) % fondos.length;
      fondoImg.src = fondos[fi];
      lastFondoChange = timeElapsed / 1000;
    }
  
    requestAnimationFrame(loop);
  }
  
  /* ===================== EVENTOS DE BOTONES PRINCIPALES ===================== */
 document.getElementById('pantallaCarga').style.display = 'none';
document.getElementById('startScreen').style.display = 'flex';
music.play();
console.log('üöÄ Precarga omitida. Juego listo.');

  
  document.getElementById('reiniciarBtn').addEventListener('click', () => location.reload());
  
  document.getElementById('btnTienda').addEventListener('click', () => {
    const tienda = document.getElementById('tiendaCDOGE');
    tienda.style.display = (tienda.style.display === 'block') ? 'none' : 'block';
  });
  
  document.getElementById('btnRanking').addEventListener('click', () => {
    const r = document.getElementById('rankingPanel');
    if (r.style.display === 'block') r.style.display = 'none';
    else { mostrarTopRanking(); r.style.display = 'block'; }
  });
  
  document.getElementById('closeRanking').addEventListener('click', () => {
    document.getElementById('rankingPanel').style.display = 'none';
  });
  
  /* ===================== WALLET CONEXI√ìN Y DESCONEXI√ìN ===================== */
  let walletConectada = false;
  
  document.getElementById('conectarWalletBtn').addEventListener('click', async () => {
    if (!walletConectada) {
      const opt = prompt('Selecciona tu wallet:\n1 - MetaMask\n2 - Phantom');
      if (opt === '1') conectarMetaMask();
      else if (opt === '2') conectarPhantom();
      else alert('Opci√≥n inv√°lida');
    } else {
      desconectarWallet();
    }
  });
  
  async function conectarMetaMask() {
    if (!window.ethereum) {
      if (/Mobi|Android/i.test(navigator.userAgent)) window.location.href = `https://metamask.app.link/dapp/${encodeURIComponent(location.href)}`;
      else window.open('https://metamask.io/download.html', '_blank');
      return;
    }
    try {
      const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      const acct = accounts[0];
      document.getElementById('conectarWalletBtn').textContent = `üîó ${acct.slice(0,6)}‚Ä¶${acct.slice(-4)} (Cerrar)`;
      walletConectada = true;
    } catch (e) {
      console.error(e);
      alert('Error al conectar MetaMask');
    }
  }
  
  async function conectarPhantom() {
    const p = window.solana;
    if (!p || !p.isPhantom) {
      if (/Mobi|Android/i.test(navigator.userAgent)) window.location.href = 'https://phantom.app/link';
      else window.open('https://phantom.app/', '_blank');
      return;
    }
    try {
      await p.connect();
      const pub = p.publicKey.toString();
      document.getElementById('conectarWalletBtn').textContent = `üîó ${pub.slice(0,6)}‚Ä¶${pub.slice(-4)} (Cerrar)`;
      walletConectada = true;
    } catch (e) {
      console.error(e);
      alert('Error al conectar Phantom');
    }
  }
  
  function desconectarWallet() {
    document.getElementById('conectarWalletBtn').textContent = 'üîó Conectar Wallet';
    walletConectada = false;
  }
  
  /* ===================== GUARDADO EN FIREBASE ===================== */
  function guardarJugadorAutomatic(u, pts, mns) {
    return addDoc(collection(db, "jugadores"), {
      nombre: u,
      puntaje: pts,
      monedas: mns,
      fecha: serverTimestamp()
    });
  }
  
  function mostrarTopRanking() {
    const lista = document.getElementById("topRanking");
    getDocs(query(collection(db, "jugadores"), orderBy("puntaje", "desc"), limit(5))).then(snap => {
      let html = "<h2>üèÜ Top 5 CosmoDoge</h2><ul style='list-style:none;padding:0;'>";
      snap.forEach((doc, i) => {
        const d = doc.data();
        html += `<li>#${i + 1} <strong>${d.nombre}</strong> ‚Äì ${d.puntaje} pts ‚Äì ${d.monedas} ü™ô</li>`;
      });
      lista.innerHTML = html + "</ul>";
    });
  }
  </script>
<script type="module">
  /* ===================== COMPRAS EN TIENDA CON MONEDAS INTERNAS ===================== */
  document.getElementById('comprarEscudo').addEventListener('click', () => {
    if (coins >= 1000) {
      coins -= 1000;
      agregarCargaEscudo();
      localStorage.setItem('cdogeCoins', coins);
      updHUD();
      alert('üõ°Ô∏è Escudo comprado exitosamente.');
    } else {
      alert('‚ùå No tienes suficientes monedas.');
    }
  });
  
  /* ===================== COMPRAS CON TOKENS (Simuladas) ===================== */
  document.getElementById('comprarImanCDOGE').addEventListener('click', () => {
    if (totalCDOGE >= 1500) {
      totalCDOGE -= 1500;
      localStorage.setItem('cdogeTotalCoins', totalCDOGE);
      activarImanCompra();
      updHUD();
      alert('üß≤ Im√°n comprado con $CDOGE.');
    } else {
      alert('‚ùå No tienes suficientes $CDOGE.');
    }
  });
  
  document.getElementById('comprarImanBCOSMO').addEventListener('click', () => {
    if (totalBCOSMO >= 2500) {
      totalBCOSMO -= 2500;
      localStorage.setItem('bcosmoTotalCoins', totalBCOSMO);
      activarImanCompra();
      updHUD();
      alert('üß≤ Im√°n comprado con $BCOSMO.');
    } else {
      alert('‚ùå No tienes suficientes $BCOSMO.');
    }
  });
  
  /* ===================== ACTIVAR IM√ÅN TRAS COMPRA ===================== */
  function activarImanCompra() {
    showMsg('üß≤ ¬°Im√°n activado!', canvas.width / 2, 100);
    localStorage.setItem('imanExpiracion', Date.now() + 3600000); // 1 hora
  }
  
  /* ===================== FUNCIONES ADICIONALES ===================== */
  function showMsg(text, x, y) {
    const div = document.createElement('div');
    Object.assign(div.style, {
      position: 'absolute', left: `${x}px`, top: `${y}px`,
      color: '#0ff', font: '18px Orbitron', zIndex: 10000, transition: 'all 1.5s'
    });
    div.textContent = text;
    document.body.appendChild(div);
    setTimeout(() => { div.style.opacity = 0; div.style.transform = 'translateY(-40px)'; }, 100);
    setTimeout(() => div.remove(), 1600);
  }
  
  /* ===================== FINAL DEL SCRIPT ===================== */
  </script>
  <!-- Cierre final del juego CosmoDoge -->
</body>
</html>
